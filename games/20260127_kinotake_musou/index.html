<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ãã®ã“ç„¡åŒ | DreamCore</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;800&display=swap" rel="stylesheet">

  <!-- CDN Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>

  <!-- Three.js (ã‚°ãƒ­ãƒ¼ãƒãƒ«ç‰ˆ) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script type="module" crossorigin>(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))a(c);new MutationObserver(c=>{for(const i of c)if(i.type==="childList")for(const m of i.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&a(m)}).observe(document,{childList:!0,subtree:!0});function s(c){const i={};return c.integrity&&(i.integrity=c.integrity),c.referrerPolicy&&(i.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?i.credentials="include":c.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(c){if(c.ep)return;c.ep=!0;const i=s(c);fetch(c.href,i)}})();const P=1e3/60,ee=100,l={arenaRadius:10,playerSpeed:7.2,enemySpeed:2.4,spawnPerSecond:2.6,maxEnemies:60,autoAttackInterval:.18,autoAttackRange:3,bulletSpeed:18,bulletLife:.45,specialRadius:4.6,specialCooldown:6.5,roundTime:30},t={phase:"title",timeLeft:l.roundTime,ko:0,elapsed:0,hp:3,invuln:0,combo:0,comboTimer:0,heat:0,hitstop:0,pointerDown:!1,pointerId:-1,swipeStart:{x:0,y:0},swipeNow:{x:0,y:0},moveVec:new THREE.Vector2(0,0),atkTimer:0,spawnTimer:0,specialReadyIn:0},R=(()=>{let e=null;function n(){return e||(e=new(window.AudioContext||window.webkitAudioContext)),e}function s(m=660,d=.06,h="square",x=.04){try{const y=n(),w=y.currentTime,v=y.createOscillator(),o=y.createGain();v.type=h,v.frequency.setValueAtTime(m,w),v.frequency.exponentialRampToValueAtTime(m*.6,w+d),o.gain.setValueAtTime(1e-4,w),o.gain.exponentialRampToValueAtTime(x,w+.01),o.gain.exponentialRampToValueAtTime(1e-4,w+d),v.connect(o),o.connect(y.destination),v.start(w),v.stop(w+d)}catch{}}function a(){s(860,.05,"square",.05)}function c(){s(140,.09,"sine",.06)}function i(){s(520,.09,"sawtooth",.06),setTimeout(()=>s(220,.11,"sine",.05),60)}return{ensure:n,pop:a,thump:c,special:i}})(),k=document.getElementById("game-canvas"),E=new THREE.Scene;E.fog=new THREE.Fog(1182486,10,26);const u=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.1,60),S=new THREE.WebGLRenderer({canvas:k,antialias:!0,alpha:!1});S.setSize(window.innerWidth,window.innerHeight);S.setPixelRatio(Math.min(window.devicePixelRatio,2));S.setClearColor(1182486,1);E.add(new THREE.AmbientLight(16777215,.7));const W=new THREE.DirectionalLight(16777215,.9);W.position.set(5,10,6);E.add(W);(()=>{const e=new THREE.CircleGeometry(l.arenaRadius+3.5,64),n=(()=>{const c=document.createElement("canvas");c.width=512,c.height=512;const i=c.getContext("2d"),m=i.createLinearGradient(0,0,512,512);m.addColorStop(0,"#ff2a6d"),m.addColorStop(.45,"#ff9f1c"),m.addColorStop(1,"#6df0ff"),i.fillStyle=m,i.fillRect(0,0,512,512);for(let x=0;x<950;x++){const y=Math.random()*512,w=Math.random()*512,v=2+Math.random()*8,o=1+Math.random()*4,p=Math.random()*Math.PI;i.save(),i.translate(y,w),i.rotate(p),i.globalAlpha=.35+Math.random()*.35;const f=["#ffffff","#0011ff","#00ff66","#ffe600","#ff004c"];i.fillStyle=f[Math.random()*f.length|0],i.fillRect(-v/2,-o/2,v,o),i.restore()}const d=i.createRadialGradient(256,256,60,256,256,330);d.addColorStop(0,"rgba(0,0,0,0)"),d.addColorStop(1,"rgba(0,0,0,0.45)"),i.fillStyle=d,i.fillRect(0,0,512,512);const h=new THREE.CanvasTexture(c);return h.wrapS=h.wrapT=THREE.RepeatWrapping,h.repeat.set(1.2,1.2),h.encoding=THREE.sRGBEncoding,h})(),s=new THREE.MeshStandardMaterial({map:n,roughness:1,metalness:0}),a=new THREE.Mesh(e,s);a.rotation.x=-Math.PI/2,a.position.y=-.01,a.receiveShadow=!1,E.add(a)})();(()=>{const e=new THREE.RingGeometry(l.arenaRadius+2.4,l.arenaRadius+3,64),n=new THREE.MeshBasicMaterial({color:16773808,transparent:!0,opacity:.35,side:THREE.DoubleSide}),s=new THREE.Mesh(e,n);s.rotation.x=-Math.PI/2,s.position.y=.02,E.add(s)})();const te=new THREE.TextureLoader;function X(e){const n=te.load(e);return n.encoding=THREE.sRGBEncoding,n.magFilter=THREE.NearestFilter,n.minFilter=THREE.LinearMipMapLinearFilter,n.anisotropy=4,n}const oe=X("./assets/kinoko.png"),ne=X("./assets/takenoko.png");function Y(e,n=1.45){const s=new THREE.PlaneGeometry(n,n),a=new THREE.MeshStandardMaterial({map:e,transparent:!0,alphaTest:.35,roughness:.8,metalness:0}),c=new THREE.Mesh(s,a);return c.rotation.order="YXZ",c}const r=(()=>{const e=Y(oe,1.65);return e.position.set(0,.95,0),E.add(e),{mesh:e,pos:new THREE.Vector3(0,0,0),vel:new THREE.Vector3(0,0,0)}})(),T=[],I=[],H=[];function se(){if(T.length>=l.maxEnemies)return;const e=Math.random()*Math.PI*2,n=l.arenaRadius+1.5,s=Math.cos(e)*n,a=Math.sin(e)*n,c=THREE.MathUtils.clamp(.08+t.elapsed/l.roundTime*.22,.08,.3),i=Math.random()<c?"charger":"grunt",d=Y(ne,i==="charger"?1.55:1.35);d.position.set(s,.85,a),E.add(d);const h=d.material;T.push({kind:i,mesh:d,material:h,pos:new THREE.Vector3(s,0,a),vel:new THREE.Vector3(0,0,0),alive:!0,wobble:Math.random()*Math.PI*2,hp:i==="charger"?2:1,telegraph:0,dash:0,dashDir:new THREE.Vector3(0,0,1),hitFlash:0})}function ae(e,n){const s=new THREE.Vector3().subVectors(n,e).normalize(),a=new THREE.Mesh(new THREE.SphereGeometry(.11,10,10),new THREE.MeshStandardMaterial({color:2824976,roughness:.6,metalness:0,emissive:590849}));a.position.copy(e),a.position.y=.95,E.add(a),I.push({mesh:a,pos:e.clone(),vel:s.multiplyScalar(l.bulletSpeed),life:l.bulletLife})}function ie(e,n){H.push({pos:new THREE.Vector3(e,.12,n),life:.32,seed:Math.random()*9999})}const D={target:new THREE.Vector3(0,0,0),pos:new THREE.Vector3(0,9,9)};u.position.copy(D.pos);u.lookAt(0,0,0);const re=document.getElementById("app");function C(){const e="â¤".repeat(Math.max(0,t.hp))+"â™¡".repeat(Math.max(0,3-t.hp));re.innerHTML=`
  <div class="hud">
    <div class="hud-left">
      <div class="pill"><span class="label">TIME</span><span id="time" class="value">${t.timeLeft.toFixed(1)}</span></div>
      <div class="pill"><span class="label">KO</span><span id="ko" class="value">${t.ko}</span></div>
      <div class="pill hp"><span class="label">HP</span><span id="hp" class="value">${e}</span></div>
    </div>

    <div class="hud-right">
      <div class="meter" title="è¿‘è·é›¢ã§ä¸ŠãŒã‚‹ã€‚æ”»æ’ƒãŒé€Ÿããªã‚‹ã‘ã©å±ãªã„">
        <div class="meter-top">
          <span class="m-label">HEAT</span>
          <span class="m-value" id="heatTxt">x${(1+t.heat*.9).toFixed(2)}</span>
        </div>
        <div class="bar"><div class="barFill" id="heat" style="width:${(t.heat*100).toFixed(0)}%"></div></div>
      </div>

      <button id="specialBtn" class="special" ${t.phase!=="playing"?"disabled":""}>
        <div class="special-top">å¿…æ®º</div>
        <div class="special-sub">${t.specialReadyIn>0?`CT ${t.specialReadyIn.toFixed(1)}s`:"READY"}</div>
      </button>
    </div>
  </div>

  <div class="center-layer" id="centerLayer"></div>
  `}function ce(){const e=document.getElementById("centerLayer");e.innerHTML=`
    <div class="card">
      <div class="badge">ğŸ„ vs ğŸ</div>
      <h1 class="title">ãã®ã“ç„¡åŒ</h1>
      <p class="subtitle">30ç§’ã§ãŸã‘ã®ã“ã‚’ã©ã‚Œã ã‘å€’ã›ã‚‹ï¼Ÿ</p>

      <div class="howto">
        <div class="howto-item"><span class="k">æ“ä½œ</span><span class="v">ã‚¹ãƒ¯ã‚¤ãƒ—ã§ç§»å‹•</span></div>
        <div class="howto-item"><span class="k">æ”»æ’ƒ</span><span class="v">è¿‘ã„æ•µã‚’ã‚ªãƒ¼ãƒˆã§æ”»æ’ƒ</span></div>
        <div class="howto-item"><span class="k">å¿…æ®º</span><span class="v">ãƒœã‚¿ãƒ³ã§å‘¨å›²ã‚’ä¸€æƒï¼ˆCTã‚ã‚Šï¼‰</span></div>
      </div>

      <button id="startBtn" class="btn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      <div class="hint">â€»éŸ³ã‚’é³´ã‚‰ã—ãŸã„äººã¯ã€æœ€åˆã®ã‚¿ãƒƒãƒ—ã§è‡ªå‹•çš„ã«åŠ¹æœéŸ³ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™</div>
    </div>
  `,document.getElementById("startBtn").addEventListener("click",()=>{R.ensure(),_()})}function le(){const e=document.getElementById("centerLayer");e.innerHTML=`
    <div class="card result">
      <div class="badge">RESULT</div>
      <h2 class="title">KO: ${t.ko}</h2>
      <p class="subtitle">ãã®ã“æ´¾ã€å¼·ã™ãã€‚</p>

      <div class="cta">
        <button id="retryBtn" class="btn">ã‚‚ã†ä¸€å›</button>
        <button id="copyBtn" class="btn ghost">æŠ•ç¨¿æ–‡ã‚³ãƒ”ãƒ¼</button>
      </div>

      <div class="hint">Xã«å‹•ç”»ã‚’è¼‰ã›ã¦ã€ãƒªãƒ—ã«DreamCoreãƒªãƒ³ã‚¯ã‚’è²¼ã‚‹æƒ³å®š</div>
    </div>
  `,document.getElementById("retryBtn").addEventListener("click",()=>{R.ensure(),Z(!1),_()}),document.getElementById("copyBtn").addEventListener("click",async()=>{const n=`ã€ãã®ã“ç„¡åŒã€‘30ç§’ã§KO: ${t.ko}ã€‚
ã‚ãªãŸã¯ä½•KOã„ã‘ã‚‹ï¼Ÿï¼ˆå‹•ç”»ã¤ãï¼‰
#ãã®ã“ã®å±± #ãŸã‘ã®ã“ã®é‡Œ #ãã®ã“ãŸã‘ã®ã“æˆ¦äº‰`;try{await navigator.clipboard.writeText(n),G("ã‚³ãƒ”ãƒ¼ã—ãŸï¼ã“ã®ã¾ã¾Xã«è²¼ã‚Œã‚‹ã‚ˆ"),R.pop()}catch{G("ã‚³ãƒ”ãƒ¼ã§ããªã‹ã£ãŸâ€¦ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶æ¨©é™ï¼‰")}})}let O=null;function G(e){const n=document.getElementById("centerLayer"),s=document.createElement("div");s.className="toast",s.textContent=e,n.appendChild(s),gsap.fromTo(s,{y:12,opacity:0},{y:0,opacity:1,duration:.22,ease:"power2.out"}),clearTimeout(O),O=setTimeout(()=>{gsap.to(s,{opacity:0,y:-8,duration:.25,onComplete:()=>s.remove()})},1200)}function B(){document.getElementById("specialBtn").addEventListener("click",()=>{R.ensure(),ue()})}function pe(){for(const e of I)E.remove(e.mesh);I.length=0;for(const e of T)E.remove(e.mesh);T.length=0,H.length=0,r.pos.set(0,0,0),r.mesh.position.set(0,.95,0)}function Z(e=!0){t.phase="title",t.timeLeft=l.roundTime,t.ko=0,t.elapsed=0,t.hp=3,t.invuln=0,t.combo=0,t.comboTimer=0,t.heat=0,t.hitstop=0,t.atkTimer=0,t.spawnTimer=0,t.specialReadyIn=0,pe(),C(),B(),e&&ce()}function _(){t.phase="playing",t.timeLeft=l.roundTime,t.ko=0,t.elapsed=0,t.hp=3,t.invuln=0,t.combo=0,t.comboTimer=0,t.heat=0,t.hitstop=0,t.atkTimer=0,t.spawnTimer=0,t.specialReadyIn=0,C(),B();const e=document.getElementById("centerLayer");gsap.to(e,{opacity:0,duration:.25,onComplete:()=>{e.innerHTML="",e.style.opacity="1"}}),gsap.fromTo(r.mesh.scale,{x:.3,y:.3,z:.3},{x:1,y:1,z:1,duration:.6,ease:"elastic.out(1,0.55)"})}function N(){t.phase="result",C(),B(),le()}function $(e){return{x:e.clientX,y:e.clientY}}function de(e){if(t.phase==="title"&&R.ensure(),t.phase!=="playing")return;const n=e.target;n&&n.closest&&n.closest("#specialBtn")||(t.pointerDown=!0,t.pointerId=e.pointerId,t.swipeStart=$(e),t.swipeNow=$(e),e.target.setPointerCapture?.(e.pointerId))}function me(e){if(!t.pointerDown||e.pointerId!==t.pointerId)return;t.swipeNow=$(e);const n=t.swipeNow.x-t.swipeStart.x,s=t.swipeNow.y-t.swipeStart.y,a=new THREE.Vector2(n,s);if(a.length()<4){t.moveVec.set(0,0);return}a.normalize(),t.moveVec.set(a.x,-a.y)}function U(e){e.pointerId===t.pointerId&&(t.pointerDown=!1,t.pointerId=-1,t.moveVec.set(0,0))}function ue(){if(t.phase!=="playing")return;if(t.specialReadyIn>0){R.thump();return}t.specialReadyIn=l.specialCooldown,R.special();const e=new THREE.Mesh(new THREE.RingGeometry(.2,.25,48),new THREE.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.9,side:THREE.DoubleSide}));e.rotation.x=-Math.PI/2,e.position.set(r.pos.x,.06,r.pos.z),E.add(e),gsap.to(e.scale,{x:l.specialRadius*3.2,y:l.specialRadius*3.2,z:1,duration:.35,ease:"power2.out"}),gsap.to(e.material,{opacity:0,duration:.35,ease:"power2.out",onComplete:()=>E.remove(e)});const n=r.pos.x,s=r.pos.z;for(const a of T){if(!a.alive)continue;const c=a.pos.x-n,i=a.pos.z-s;Math.hypot(c,i)<=l.specialRadius&&j(a,!0)}gsap.fromTo(u.position,{x:u.position.x+.12,y:u.position.y,z:u.position.z+.12},{x:u.position.x,z:u.position.z,duration:.25,ease:"elastic.out(1,0.6)"})}function he(e,n=1,s=!1){e.alive&&(e.hp-=n,e.hitFlash=.12,e.material&&(e.material.emissive=new THREE.Color(16777215),e.material.emissiveIntensity=.9),e.hp<=0&&j(e,s))}function j(e,n=!1){if(!e.alive)return;e.alive=!1,t.combo+=1,t.comboTimer=1.25;const s=e.pos.x-r.pos.x,a=e.pos.z-r.pos.z,i=s*s+a*a<1.4*1.4?1:0;t.ko+=1+i,i&&G("è¿‘è·é›¢ãƒœãƒ¼ãƒŠã‚¹ +1KO"),t.specialReadyIn=Math.max(0,t.specialReadyIn-(n?.35:.15)),ie(e.pos.x,e.pos.z),R.pop(),t.hitstop=Math.min(.06,t.hitstop+(n?.03:.02)),u.position.x+=(Math.random()-.5)*.12,u.position.z+=(Math.random()-.5)*.12,gsap.to(e.mesh.scale,{x:.01,y:.01,z:.01,duration:n?.14:.18,ease:"back.in(3)",onComplete:()=>{E.remove(e.mesh)}})}function fe(e){if(t.atkTimer-=e,t.atkTimer>0)return;const n=1+t.heat*.9,s=1+Math.min(1.5,t.combo*.03),a=Math.max(.08,l.autoAttackInterval/(n*(.85+s*.15)));t.atkTimer=a;let c=null,i=1/0;for(const d of T){if(!d.alive)continue;const h=d.pos.x-r.pos.x,x=d.pos.z-r.pos.z,y=Math.hypot(h,x);y<i&&(i=y,c=d)}if(!c||i>l.autoAttackRange)return;const m=new THREE.Vector3(c.pos.x,0,c.pos.z);ae(new THREE.Vector3(r.pos.x,0,r.pos.z),m)}function q(e){const n=Math.hypot(e.x,e.z),s=l.arenaRadius;if(n>s){const a=s/n;e.x*=a,e.z*=a}}function Ee(e){if(t.hitstop>0){t.hitstop=Math.max(0,t.hitstop-e),r.mesh.rotation.y+=e*1.2;return}if(t.phase!=="playing"){r.mesh.rotation.y+=e*.6;return}if(t.elapsed+=e,t.timeLeft=Math.max(0,l.roundTime-t.elapsed),t.timeLeft<=0){N();return}t.specialReadyIn=Math.max(0,t.specialReadyIn-e),t.comboTimer=Math.max(0,t.comboTimer-e),t.comboTimer<=0&&t.combo>0&&(t.combo=0);let n=0;for(const o of T){if(!o.alive)continue;const p=o.pos.x-r.pos.x,f=o.pos.z-r.pos.z;p*p+f*f<2.2*2.2&&n++}const s=Math.min(1,n/6);t.heat=THREE.MathUtils.lerp(t.heat,s,.08),t.spawnTimer+=e;const a=1/l.spawnPerSecond;for(;t.spawnTimer>=a;)t.spawnTimer-=a,se();const c=t.moveVec.clone().multiplyScalar(l.playerSpeed);r.vel.x=c.x,r.vel.z=c.y,r.pos.x+=r.vel.x*e,r.pos.z+=r.vel.z*e,q(r.pos),r.mesh.position.set(r.pos.x,.95,r.pos.z);const i=THREE.MathUtils.clamp(r.vel.x/l.playerSpeed,-1,1)*-.18,m=THREE.MathUtils.clamp(r.vel.z/l.playerSpeed,-1,1)*.18;r.mesh.rotation.x=THREE.MathUtils.lerp(r.mesh.rotation.x,m,.12),r.mesh.rotation.z=THREE.MathUtils.lerp(r.mesh.rotation.z,i,.12),t.invuln=Math.max(0,t.invuln-e);for(const o of T){if(!o.alive)continue;o.hitFlash=Math.max(0,o.hitFlash-e),o.material&&(o.material.emissiveIntensity=o.hitFlash>0?.9:0);const p=r.pos.x-o.pos.x,f=r.pos.z-o.pos.z,b=Math.hypot(p,f)||1,g=p/b,z=f/b;o.wobble+=e*6.2;const L=Math.sin(o.wobble)*.18;if(o.kind==="charger")if(o.dash>0){o.dash=Math.max(0,o.dash-e);const M=9.6;o.vel.x=o.dashDir.x*M,o.vel.z=o.dashDir.z*M}else o.telegraph>0?(o.telegraph=Math.max(0,o.telegraph-e),o.vel.x=0,o.vel.z=0,o.material&&(o.material.emissive=new THREE.Color(16773808),o.material.emissiveIntensity=.6+Math.sin(o.wobble*6)*.25),o.telegraph<=0&&(o.dash=.35,o.dashDir.set(g,0,z))):(o.vel.x=(g+L*z)*(l.enemySpeed*.9),o.vel.z=(z-L*g)*(l.enemySpeed*.9),b<4.2&&Math.random()<e*.8&&(o.telegraph=.35));else o.vel.x=(g+L*z)*l.enemySpeed,o.vel.z=(z-L*g)*l.enemySpeed;o.pos.x+=o.vel.x*e,o.pos.z+=o.vel.z*e,q(o.pos);const Q=Math.sin(o.wobble*.5)*.05;if(o.mesh.position.set(o.pos.x,.85+Q,o.pos.z),b<.85&&(r.pos.x-=g*.22,r.pos.z-=z*.22,t.invuln<=0)){t.hp-=1,t.invuln=.75,t.combo=0,t.comboTimer=0,t.hitstop=Math.max(t.hitstop,.08),R.thump(),u.position.x+=(Math.random()-.5)*.35,u.position.z+=(Math.random()-.5)*.35;const M=r.mesh.material;M&&(M.opacity=.3,M.transparent=!0,gsap.to(M,{opacity:1,duration:.22,yoyo:!0,repeat:3,ease:"power2.out"}));const A=document.getElementById("hp");if(A&&(A.textContent="â¤".repeat(Math.max(0,t.hp))+"â™¡".repeat(Math.max(0,3-t.hp)),gsap.fromTo(A,{scale:1.3},{scale:1,duration:.25,ease:"back.out(3)"})),t.hp<=0){N();return}}}fe(e);for(let o=I.length-1;o>=0;o--){const p=I[o];p.life-=e,p.pos.x+=p.vel.x*e,p.pos.z+=p.vel.z*e,p.mesh.position.set(p.pos.x,.9,p.pos.z);for(const f of T){if(!f.alive)continue;const b=f.pos.x-p.pos.x,g=f.pos.z-p.pos.z;if(b*b+g*g<.42*.42){he(f,1,!1),p.life=-1;break}}p.life<=0&&(E.remove(p.mesh),I.splice(o,1))}for(let o=H.length-1;o>=0;o--)H[o].life-=e,H[o].life<=0&&H.splice(o,1);D.target.set(r.pos.x,0,r.pos.z);const d=new THREE.Vector3(r.pos.x,8.8,r.pos.z+9.2);u.position.lerp(d,.08),u.lookAt(D.target);const h=document.getElementById("time"),x=document.getElementById("ko"),y=document.getElementById("heat"),w=document.getElementById("heatTxt"),v=document.getElementById("specialBtn");if(h&&(h.textContent=t.timeLeft.toFixed(1)),x&&(x.textContent=String(t.ko)),y&&(y.style.width=`${(t.heat*100).toFixed(0)}%`),w&&(w.textContent=`x${(1+t.heat*.9).toFixed(2)}`),v){const o=v;o.disabled=t.phase!=="playing";const p=o.querySelector(".special-sub");p&&(p.textContent=t.specialReadyIn>0?`CT ${t.specialReadyIn.toFixed(1)}s`:"READY"),o.classList.toggle("ready",t.specialReadyIn<=0)}}const F=(()=>{const e=new THREE.BufferGeometry,n=new THREE.PointsMaterial({size:.14,color:16777215,transparent:!0,opacity:.9}),s=new THREE.Points(e,n);return s.frustumCulled=!1,E.add(s),{geo:e,mat:n,points:s}})();function ve(){for(const a of T)a.alive&&a.mesh.lookAt(u.position);r.mesh.lookAt(u.position);const e=[],n=[];for(const a of H){const c=a.life/.32,i=12;for(let m=0;m<i;m++){const d=m/i*Math.PI*2+a.seed,h=(1-c)*.9,x=a.pos.x+Math.cos(d)*h,y=.12+(1-c)*.6+Math.sin(d*2)*.05,w=a.pos.z+Math.sin(d)*h;e.push(x,y,w);const v=[[1,1,1],[1,.92,.2],[.2,1,.55],[.2,.8,1],[1,.2,.6]],o=a.seed*1e3|0,p=(m+o)%v.length,f=v[p];n.push(f[0],f[1],f[2])}}const s=F.geo;s.setAttribute("position",new THREE.Float32BufferAttribute(e,3)),s.setAttribute("color",new THREE.Float32BufferAttribute(n,3)),F.mat.vertexColors=!0,F.mat.opacity=t.phase==="playing"?.95:.55,S.render(E,u)}let K=0,V=0;function J(e){const n=Math.min(e-K,ee);for(K=e,V+=n;V>=P;)Ee(P/1e3),V-=P;ve(),requestAnimationFrame(J)}function ye(){u.aspect=window.innerWidth/window.innerHeight,u.updateProjectionMatrix(),S.setSize(window.innerWidth,window.innerHeight)}function we(){C(),B(),Z(!0),window.addEventListener("resize",ye),k.addEventListener("pointerdown",de,{passive:!0}),k.addEventListener("pointermove",me,{passive:!0}),k.addEventListener("pointerup",U,{passive:!0}),k.addEventListener("pointercancel",U,{passive:!0}),requestAnimationFrame(J)}we();</script>
  <style rel="stylesheet" crossorigin>:root{--bg0: #120b16;--bg1: #1b1023;--hot: #ff2a6d;--lemon: #ffe600;--mint: #18ffb8;--sky: #6df0ff;--ink: rgba(255, 255, 255, .92);--ink-dim: rgba(255, 255, 255, .72);--shadow: rgba(0, 0, 0, .35);--radius: 22px}*{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;overflow:hidden;font-family:"M PLUS Rounded 1c",system-ui,-apple-system,Segoe UI,sans-serif;background:radial-gradient(1200px 900px at 15% 10%,rgba(255,42,109,.18),transparent 60%),radial-gradient(900px 700px at 85% 20%,rgba(109,240,255,.18),transparent 55%),linear-gradient(160deg,var(--bg0),var(--bg1));color:var(--ink);touch-action:manipulation;-webkit-tap-highlight-color:transparent;user-select:none}#game-canvas{position:fixed;inset:0;width:100%;height:100%;z-index:0}#app{position:fixed;inset:0;width:100%;height:100%;z-index:10;pointer-events:none}.hud{position:absolute;top:14px;left:14px;right:14px;display:flex;align-items:flex-start;justify-content:space-between;gap:12px;pointer-events:none}.hud-right{display:flex;align-items:flex-start;gap:10px}.hud-left{display:flex;gap:10px}.pill{pointer-events:none;display:inline-flex;align-items:baseline;gap:10px;padding:10px 12px;border-radius:999px;background:#ffffff14;backdrop-filter:blur(10px);box-shadow:0 10px 30px var(--shadow);border:1px solid rgba(255,255,255,.12)}.pill.hp .value{letter-spacing:.14em}.pill .label{font-weight:800;letter-spacing:.08em;font-size:11px;color:#ffffffbf}.pill .value{font-weight:800;font-size:18px;color:#fffffff2;text-shadow:0 6px 18px rgba(0,0,0,.35)}.meter{pointer-events:none;width:142px;padding:10px 12px;border-radius:18px;background:#ffffff14;backdrop-filter:blur(10px);box-shadow:0 10px 30px var(--shadow);border:1px solid rgba(255,255,255,.12)}.meter-top{display:flex;justify-content:space-between;align-items:baseline;gap:10px}.m-label{font-weight:900;letter-spacing:.12em;font-size:11px;color:#ffffffb3}.m-value{font-weight:900;font-size:12px;color:#ffffffe6}.bar{margin-top:7px;height:10px;border-radius:999px;overflow:hidden;background:#00000047;border:1px solid rgba(255,255,255,.1)}.barFill{height:100%;width:0%;background:linear-gradient(90deg,#18ffb8f2,#ffe600f2,#ff2a6df2);transition:width .12s linear}.special{pointer-events:auto;border:0;border-radius:18px;padding:10px 12px;width:96px;cursor:pointer;color:#111;background:linear-gradient(135deg,#ffe600f2,#18ffb8e6);box-shadow:0 16px 40px #00000059;transform:translateZ(0);transition:transform .12s ease,filter .12s ease,opacity .12s ease}.special:active{transform:scale(.98)}.special:disabled{opacity:.55;filter:grayscale(.4);cursor:not-allowed}.special.ready{box-shadow:0 0 0 1px #ffe60073,0 18px 44px #ff2a6d40}.special-top{font-weight:900;font-size:16px;letter-spacing:.06em}.special-sub{margin-top:2px;font-weight:800;font-size:12px;opacity:.78}.center-layer{position:absolute;inset:0;display:grid;place-items:center;padding:18px;pointer-events:none}.card{pointer-events:auto;width:min(540px,100%);border-radius:var(--radius);padding:22px 18px 18px;background:#0a080e9e;backdrop-filter:blur(14px);border:1px solid rgba(255,255,255,.14);box-shadow:0 30px 80px #0000008c}.badge{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;font-weight:900;letter-spacing:.08em;font-size:12px;background:#ffffff14;border:1px solid rgba(255,255,255,.12)}.title{margin-top:10px;font-size:clamp(2.1rem,8vw,3.1rem);font-weight:900;line-height:1.05;background:linear-gradient(135deg,var(--lemon),var(--hot),var(--sky));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-shadow:0 12px 30px rgba(255,42,109,.25)}.subtitle{margin-top:10px;color:var(--ink-dim);font-weight:800;line-height:1.55}.howto{margin-top:16px;display:grid;gap:10px}.howto-item{display:flex;justify-content:space-between;gap:12px;padding:10px 12px;border-radius:14px;background:#ffffff12;border:1px solid rgba(255,255,255,.12)}.howto-item .k{font-weight:900;letter-spacing:.06em;color:#ffffffeb}.howto-item .v{font-weight:800;color:#ffffffbf}.btn{margin-top:18px;width:100%;border:0;border-radius:16px;padding:14px 16px;font-size:16px;font-weight:900;letter-spacing:.03em;cursor:pointer;background:linear-gradient(135deg,var(--hot),#ff9f1c);color:#fffffff5;box-shadow:0 18px 44px #ff2a6d40;transition:transform .12s ease,filter .12s ease}.btn:active{transform:scale(.99)}.btn.ghost{background:#ffffff14;border:1px solid rgba(255,255,255,.14);box-shadow:0 20px 50px #00000059}.cta{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:18px}.hint{margin-top:12px;font-size:12px;line-height:1.45;color:#ffffff9e}.toast{position:absolute;bottom:18px;left:50%;transform:translate(-50%);padding:10px 14px;border-radius:999px;background:#0000008c;border:1px solid rgba(255,255,255,.16);box-shadow:0 18px 50px #0000008c;font-weight:900;letter-spacing:.02em}@media (max-width: 420px){.cta{grid-template-columns:1fr}.special{width:88px}}</style>
</head>

<body>
  <div id="app"></div>
  <canvas id="game-canvas"></canvas>
</body>

</html>