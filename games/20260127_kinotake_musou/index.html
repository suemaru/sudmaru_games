<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ãã®ã“ç„¡åŒ | DreamCore</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;800&display=swap" rel="stylesheet">

  <!-- CDN Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>

  <!-- Three.js (ã‚°ãƒ­ãƒ¼ãƒãƒ«ç‰ˆ) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script type="module" crossorigin>(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const p of c.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function a(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(r){if(r.ep)return;r.ep=!0;const c=a(r);fetch(r.href,c)}})();const F=1e3/60,ie=100,l={arenaRadius:18,playerSpeed:9,enemySpeed:2.7,spawnPerSecond:12,maxEnemies:220,autoAttackInterval:.12,autoAttackRange:3.8,bulletSpeed:26,bulletLife:.5,specialRadius:6.6,specialCooldown:5.5,roundTime:30},t={phase:"title",timeLeft:l.roundTime,ko:0,elapsed:0,hp:3,invuln:0,combo:0,comboTimer:0,heat:0,hitstop:0,pointerDown:!1,pointerId:-1,swipeStart:{x:0,y:0},swipeNow:{x:0,y:0},moveVec:new THREE.Vector2(0,0),keys:{up:!1,down:!1,left:!1,right:!1},atkTimer:0,spawnTimer:0,specialReadyIn:0},b=(()=>{let e=null;function o(){return e||(e=new(window.AudioContext||window.webkitAudioContext)),e}function a(p=660,u=.06,d="square",y=.04){try{const v=o(),m=v.currentTime,w=v.createOscillator(),x=v.createGain();w.type=d,w.frequency.setValueAtTime(p,m),w.frequency.exponentialRampToValueAtTime(p*.6,m+u),x.gain.setValueAtTime(1e-4,m),x.gain.exponentialRampToValueAtTime(y,m+.01),x.gain.exponentialRampToValueAtTime(1e-4,m+u),w.connect(x),x.connect(v.destination),w.start(m),w.stop(m+u)}catch{}}function i(){a(860,.05,"square",.05)}function r(){a(140,.09,"sine",.06)}function c(){a(520,.09,"sawtooth",.06),setTimeout(()=>a(220,.11,"sine",.05),60)}return{ensure:o,pop:i,thump:r,special:c}})(),B=document.getElementById("game-canvas"),E=new THREE.Scene;E.fog=new THREE.Fog(16774102,26,70);const f=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.1,80),z=new THREE.WebGLRenderer({canvas:B,antialias:!0,alpha:!1});z.setSize(window.innerWidth,window.innerHeight);z.setPixelRatio(Math.min(window.devicePixelRatio,2));z.setClearColor(16774102,1);z.outputEncoding=THREE.sRGBEncoding;z.toneMapping=THREE.ACESFilmicToneMapping;z.toneMappingExposure=1.15;E.add(new THREE.AmbientLight(16777215,1.05));const re=new THREE.HemisphereLight(16777215,16762856,.65);E.add(re);const ee=new THREE.DirectionalLight(16777215,1.1);ee.position.set(6,12,7);E.add(ee);(()=>{const e=new THREE.CircleGeometry(l.arenaRadius+3.5,64),o=(()=>{const r=document.createElement("canvas");r.width=512,r.height=512;const c=r.getContext("2d"),p=c.createLinearGradient(0,0,512,512);p.addColorStop(0,"#ff2a6d"),p.addColorStop(.45,"#ff9f1c"),p.addColorStop(1,"#6df0ff"),c.fillStyle=p,c.fillRect(0,0,512,512);for(let y=0;y<950;y++){const v=Math.random()*512,m=Math.random()*512,w=2+Math.random()*8,x=1+Math.random()*4,S=Math.random()*Math.PI;c.save(),c.translate(v,m),c.rotate(S),c.globalAlpha=.35+Math.random()*.35;const R=["#ffffff","#0011ff","#00ff66","#ffe600","#ff004c"];c.fillStyle=R[Math.random()*R.length|0],c.fillRect(-w/2,-x/2,w,x),c.restore()}const u=c.createRadialGradient(256,256,60,256,256,330);u.addColorStop(0,"rgba(0,0,0,0)"),u.addColorStop(1,"rgba(0,0,0,0.45)"),c.fillStyle=u,c.fillRect(0,0,512,512);const d=new THREE.CanvasTexture(r);return d.wrapS=d.wrapT=THREE.RepeatWrapping,d.repeat.set(1.2,1.2),d.encoding=THREE.sRGBEncoding,d})(),a=new THREE.MeshStandardMaterial({map:o,roughness:1,metalness:0}),i=new THREE.Mesh(e,a);i.rotation.x=-Math.PI/2,i.position.y=-.01,i.receiveShadow=!1,E.add(i)})();(()=>{const e=new THREE.RingGeometry(l.arenaRadius+2.4,l.arenaRadius+3,64),o=new THREE.MeshBasicMaterial({color:16773808,transparent:!0,opacity:.35,side:THREE.DoubleSide}),a=new THREE.Mesh(e,o);a.rotation.x=-Math.PI/2,a.position.y=.02,E.add(a)})();const ce=new THREE.TextureLoader;function q(e){const o=ce.load(e);return o.encoding=THREE.sRGBEncoding,o.magFilter=THREE.NearestFilter,o.minFilter=THREE.LinearMipMapLinearFilter,o.anisotropy=4,o}const le=q("./assets/kinoko.png"),pe=q("./assets/takenoko.png"),de=q("./assets/takenoko_charger.png");function te(e,o=1.45){const a=new THREE.PlaneGeometry(o,o),i=new THREE.MeshStandardMaterial({map:e,transparent:!0,alphaTest:.35,roughness:.8,metalness:0}),r=new THREE.Mesh(a,i);return r.rotation.order="YXZ",r}const s=(()=>{const e=te(le,1.65);e.position.set(0,.95,0),E.add(e);const o=new THREE.Mesh(new THREE.RingGeometry(.28,.42,48),new THREE.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.35,side:THREE.DoubleSide}));return o.rotation.x=-Math.PI/2,o.position.set(0,.06,0),E.add(o),{mesh:e,aura:o,pos:new THREE.Vector3(0,0,0),vel:new THREE.Vector3(0,0,0)}})(),g=[],C=[],k=[];function me(){if(g.length>=l.maxEnemies)return;const e=Math.random()*Math.PI*2,o=Math.max(10,l.arenaRadius*.75),a=o+Math.random()*(l.arenaRadius-o+2),i=s.pos.x+Math.cos(e)*a,r=s.pos.z+Math.sin(e)*a,c=THREE.MathUtils.clamp(.08+t.elapsed/l.roundTime*.22,.08,.3),p=Math.random()<c?"charger":"grunt",y=te(p==="charger"?de:pe,p==="charger"?1.55:1.35);y.position.set(i,.85,r),E.add(y);const v=y.material,m=new THREE.Vector3(i,0,r);N(m),g.push({kind:p,mesh:y,material:v,pos:m,vel:new THREE.Vector3(0,0,0),alive:!0,wobble:Math.random()*Math.PI*2,hp:p==="charger"?2:1,telegraph:0,dash:0,dashDir:new THREE.Vector3(0,0,1),hitFlash:0})}function he(e,o){const a=new THREE.Vector3().subVectors(o,e).normalize(),i=new THREE.Mesh(new THREE.SphereGeometry(.11,10,10),new THREE.MeshStandardMaterial({color:2824976,roughness:.6,metalness:0,emissive:590849}));i.position.copy(e),i.position.y=.95,E.add(i),C.push({mesh:i,pos:e.clone(),vel:a.multiplyScalar(l.bulletSpeed),life:l.bulletLife})}function ue(e,o){k.push({pos:new THREE.Vector3(e,.12,o),life:.32,seed:Math.random()*9999})}const $={target:new THREE.Vector3(0,0,0),pos:new THREE.Vector3(0,9,9)};f.position.copy($.pos);f.lookAt(0,0,0);const fe=document.getElementById("app");function K(){const e="â¤".repeat(Math.max(0,t.hp))+"â™¡".repeat(Math.max(0,3-t.hp)),o=t.combo>0?`${t.combo} HIT`:"â€”";fe.innerHTML=`
  <div class="hud">
    <div class="hud-left">
      <div class="pill"><span class="label">TIME</span><span id="time" class="value">${t.timeLeft.toFixed(1)}</span></div>
      <div class="pill"><span class="label">KO</span><span id="ko" class="value">${t.ko}</span></div>
      <div class="pill hp"><span class="label">HP</span><span id="hp" class="value">${e}</span></div>
      <div class="pill combo"><span class="label">COMBO</span><span id="combo" class="value">${o}</span></div>
    </div>

    <div class="hud-right">
      <div class="meter" title="è¿‘è·é›¢ã§ä¸ŠãŒã‚‹ã€‚æ”»æ’ƒãŒé€Ÿããªã‚‹ã‘ã©å±ãªã„">
        <div class="meter-top">
          <span class="m-label">HEAT</span>
          <span class="m-value" id="heatTxt">x${(1+t.heat*.9).toFixed(2)}</span>
        </div>
        <div class="bar"><div class="barFill" id="heat" style="width:${(t.heat*100).toFixed(0)}%"></div></div>
      </div>

      <button id="specialBtn" class="special" ${t.phase!=="playing"?"disabled":""}>
        <div class="special-top">å¿…æ®º</div>
        <div class="special-sub">${t.specialReadyIn>0?`CT ${t.specialReadyIn.toFixed(1)}s`:"READY"}</div>
      </button>
    </div>
  </div>

  <div class="center-layer" id="centerLayer"></div>
  `}function Ee(){const e=document.getElementById("centerLayer");e.innerHTML=`
    <div class="card">
      <div class="badge">ğŸ„ vs ğŸ</div>
      <h1 class="title">ãã®ã“ç„¡åŒ</h1>
      <p class="subtitle">30ç§’ã§ãŸã‘ã®ã“ã‚’ã©ã‚Œã ã‘å€’ã›ã‚‹ï¼Ÿ</p>

      <div class="howto">
        <div class="howto-item"><span class="k">æ“ä½œ</span><span class="v">ã‚¹ãƒ¯ã‚¤ãƒ—ã§ç§»å‹•</span></div>
        <div class="howto-item"><span class="k">æ”»æ’ƒ</span><span class="v">è¿‘ã„æ•µã‚’ã‚ªãƒ¼ãƒˆã§æ”»æ’ƒ</span></div>
        <div class="howto-item"><span class="k">å¿…æ®º</span><span class="v">ãƒœã‚¿ãƒ³ã§å‘¨å›²ã‚’ä¸€æƒï¼ˆCTã‚ã‚Šï¼‰</span></div>
      </div>

      <button id="startBtn" class="btn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      <div class="hint">â€»éŸ³ã‚’é³´ã‚‰ã—ãŸã„äººã¯ã€æœ€åˆã®ã‚¿ãƒƒãƒ—ã§è‡ªå‹•çš„ã«åŠ¹æœéŸ³ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™</div>
    </div>
  `,document.getElementById("startBtn").addEventListener("click",()=>{b.ensure(),W()})}function ye(){const e=document.getElementById("centerLayer");e.innerHTML=`
    <div class="card result">
      <div class="badge">RESULT</div>
      <h2 class="title">KO: ${t.ko}</h2>
      <p class="subtitle">ãã®ã“æ´¾ã€å¼·ã™ãã€‚</p>

      <div class="cta">
        <button id="retryBtn" class="btn">ã‚‚ã†ä¸€å›</button>
        <button id="copyBtn" class="btn ghost">æŠ•ç¨¿æ–‡ã‚³ãƒ”ãƒ¼</button>
      </div>

      <div class="hint">Xã«å‹•ç”»ã‚’è¼‰ã›ã¦ã€ãƒªãƒ—ã«DreamCoreãƒªãƒ³ã‚¯ã‚’è²¼ã‚‹æƒ³å®š</div>
    </div>
  `,document.getElementById("retryBtn").addEventListener("click",()=>{b.ensure(),oe(!1),W()}),document.getElementById("copyBtn").addEventListener("click",async()=>{const o=`ã€ãã®ã“ç„¡åŒã€‘30ç§’ã§KO: ${t.ko}ã€‚
ã‚ãªãŸã¯ä½•KOã„ã‘ã‚‹ï¼Ÿï¼ˆå‹•ç”»ã¤ãï¼‰
#ãã®ã“ã®å±± #ãŸã‘ã®ã“ã®é‡Œ #ãã®ã“ãŸã‘ã®ã“æˆ¦äº‰`;try{await navigator.clipboard.writeText(o),O("ã‚³ãƒ”ãƒ¼ã—ãŸï¼ã“ã®ã¾ã¾Xã«è²¼ã‚Œã‚‹ã‚ˆ"),b.pop()}catch{O("ã‚³ãƒ”ãƒ¼ã§ããªã‹ã£ãŸâ€¦ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶æ¨©é™ï¼‰")}})}let Z=null;function O(e){const o=document.getElementById("centerLayer"),a=document.createElement("div");a.className="toast",a.textContent=e,o.appendChild(a),gsap.fromTo(a,{y:12,opacity:0},{y:0,opacity:1,duration:.22,ease:"power2.out"}),clearTimeout(Z),Z=setTimeout(()=>{gsap.to(a,{opacity:0,y:-8,duration:.25,onComplete:()=>a.remove()})},1200)}function X(){document.getElementById("specialBtn").addEventListener("click",()=>{b.ensure(),Te()})}function ve(){for(const e of C)E.remove(e.mesh);C.length=0;for(const e of g)E.remove(e.mesh);g.length=0,k.length=0,s.pos.set(0,0,0),s.mesh.position.set(0,.95,0)}function oe(e=!0){t.phase="title",t.timeLeft=l.roundTime,t.ko=0,t.elapsed=0,t.hp=3,t.invuln=0,t.combo=0,t.comboTimer=0,t.heat=0,t.hitstop=0,t.atkTimer=0,t.spawnTimer=0,t.specialReadyIn=0,ve(),K(),X(),e&&Ee()}function W(){t.phase="playing",t.timeLeft=l.roundTime,t.ko=0,t.elapsed=0,t.hp=3,t.invuln=0,t.combo=0,t.comboTimer=0,t.heat=0,t.hitstop=0,t.atkTimer=0,t.spawnTimer=0,t.specialReadyIn=0,K(),X();const e=document.getElementById("centerLayer");gsap.to(e,{opacity:0,duration:.25,onComplete:()=>{e.innerHTML="",e.style.opacity="1"}}),gsap.fromTo(s.mesh.scale,{x:.3,y:.3,z:.3},{x:1,y:1,z:1,duration:.6,ease:"elastic.out(1,0.55)"})}function _(){t.phase="result",K(),X(),ye()}function U(e){return{x:e.clientX,y:e.clientY}}function we(e){if(t.phase==="title"&&b.ensure(),t.phase!=="playing")return;const o=e.target;o&&o.closest&&o.closest("#specialBtn")||(t.pointerDown=!0,t.pointerId=e.pointerId,t.swipeStart=U(e),t.swipeNow=U(e),e.target.setPointerCapture?.(e.pointerId))}function xe(e){if(!t.pointerDown||e.pointerId!==t.pointerId)return;t.swipeNow=U(e);const o=t.swipeNow.x-t.swipeStart.x,a=t.swipeNow.y-t.swipeStart.y,i=new THREE.Vector2(o,a);if(i.length()<4){t.moveVec.set(0,0);return}i.normalize(),t.moveVec.set(i.x,i.y)}function j(e){e.pointerId===t.pointerId&&(t.pointerDown=!1,t.pointerId=-1,t.moveVec.set(0,0))}function Te(){if(t.phase!=="playing")return;if(t.specialReadyIn>0){b.thump();return}t.specialReadyIn=l.specialCooldown,b.special();const e=new THREE.Mesh(new THREE.RingGeometry(.2,.25,48),new THREE.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.9,side:THREE.DoubleSide}));e.rotation.x=-Math.PI/2,e.position.set(s.pos.x,.06,s.pos.z),E.add(e),gsap.to(e.scale,{x:l.specialRadius*3.2,y:l.specialRadius*3.2,z:1,duration:.35,ease:"power2.out"}),gsap.to(e.material,{opacity:0,duration:.35,ease:"power2.out",onComplete:()=>E.remove(e)});const o=s.pos.x,a=s.pos.z;for(const i of g){if(!i.alive)continue;const r=i.pos.x-o,c=i.pos.z-a;Math.hypot(r,c)<=l.specialRadius&&ne(i,!0)}gsap.fromTo(f.position,{x:f.position.x+.12,y:f.position.y,z:f.position.z+.12},{x:f.position.x,z:f.position.z,duration:.25,ease:"elastic.out(1,0.6)"})}function ge(e,o=1,a=!1){e.alive&&(e.hp-=o,e.hitFlash=.12,e.material&&(e.material.emissive=new THREE.Color(16777215),e.material.emissiveIntensity=.9),e.hp<=0&&ne(e,a))}function ne(e,o=!1){if(!e.alive)return;e.alive=!1,t.combo+=1,t.comboTimer=1.25;const a=e.pos.x-s.pos.x,i=e.pos.z-s.pos.z,c=a*a+i*i<1.4*1.4?1:0;t.ko+=1+c,c&&O("è¿‘è·é›¢ãƒœãƒ¼ãƒŠã‚¹ +1KO"),t.specialReadyIn=Math.max(0,t.specialReadyIn-(o?.35:.15)),ue(e.pos.x,e.pos.z),b.pop(),t.hitstop=Math.min(.06,t.hitstop+(o?.03:.02)),f.position.x+=(Math.random()-.5)*.12,f.position.z+=(Math.random()-.5)*.12,gsap.to(e.mesh.scale,{x:.01,y:.01,z:.01,duration:o?.14:.18,ease:"back.in(3)",onComplete:()=>{E.remove(e.mesh)}})}function Re(e){if(t.atkTimer-=e,t.atkTimer>0)return;const o=1+t.heat*.9,a=1+Math.min(1.5,t.combo*.03),i=Math.max(.06,l.autoAttackInterval/(o*(.85+a*.15)));t.atkTimer=i;let r=null,c=1/0;for(const d of g){if(!d.alive)continue;const y=d.pos.x-s.pos.x,v=d.pos.z-s.pos.z,m=Math.hypot(y,v);m<c&&(c=m,r=d)}if(!r||c>l.autoAttackRange)return;const p=new THREE.Vector3(r.pos.x,0,r.pos.z),u=t.heat>.75?3:t.heat>.45?2:1;for(let d=0;d<u;d++){const y=(d-(u-1)/2)*.24,v=new THREE.Vector3(p.x-s.pos.x,0,p.z-s.pos.z).normalize(),m=new THREE.Matrix4().makeRotationY(y);v.applyMatrix4(m);const w=new THREE.Vector3(s.pos.x,0,s.pos.z).add(v.multiplyScalar(3));he(new THREE.Vector3(s.pos.x,0,s.pos.z),w)}}function N(e){const o=Math.hypot(e.x,e.z),a=l.arenaRadius;if(o>a){const i=a/o;e.x*=i,e.z*=i}}function Me(e){if(t.hitstop>0){t.hitstop=Math.max(0,t.hitstop-e),s.mesh.rotation.y+=e*1.2;return}if(t.phase!=="playing"){s.mesh.rotation.y+=e*.6;return}if(t.elapsed+=e,t.timeLeft=Math.max(0,l.roundTime-t.elapsed),t.timeLeft<=0){_();return}t.specialReadyIn=Math.max(0,t.specialReadyIn-e),t.comboTimer=Math.max(0,t.comboTimer-e),t.comboTimer<=0&&t.combo>0&&(t.combo=0);let o=0;for(const n of g){if(!n.alive)continue;const h=n.pos.x-s.pos.x,T=n.pos.z-s.pos.z;h*h+T*T<2.2*2.2&&o++}const a=Math.min(1,o/6);t.heat=THREE.MathUtils.lerp(t.heat,a,.08),t.spawnTimer+=e;const i=1/l.spawnPerSecond;for(;t.spawnTimer>=i;)t.spawnTimer-=i,me();const r=new THREE.Vector2(0,0);t.pointerDown?r.copy(t.moveVec):(t.keys.left&&(r.x-=1),t.keys.right&&(r.x+=1),t.keys.up&&(r.y+=1),t.keys.down&&(r.y-=1),r.lengthSq()>0&&r.normalize());const c=r.x*l.playerSpeed,p=r.y*l.playerSpeed;s.vel.x=THREE.MathUtils.lerp(s.vel.x,c,1-Math.exp(-38*e)),s.vel.z=THREE.MathUtils.lerp(s.vel.z,p,1-Math.exp(-38*e)),r.lengthSq()===0&&(s.vel.x=THREE.MathUtils.lerp(s.vel.x,0,1-Math.exp(-18*e)),s.vel.z=THREE.MathUtils.lerp(s.vel.z,0,1-Math.exp(-18*e))),s.pos.x+=s.vel.x*e,s.pos.z+=s.vel.z*e,N(s.pos),s.mesh.position.set(s.pos.x,.95,s.pos.z),s.aura.position.set(s.pos.x,.06,s.pos.z);const u=1+t.heat*1.2;s.aura.scale.set(u,u,u),s.aura.material.opacity=.18+t.heat*.28;const d=THREE.MathUtils.clamp(s.vel.x/l.playerSpeed,-1,1)*-.18,y=THREE.MathUtils.clamp(s.vel.z/l.playerSpeed,-1,1)*.18;s.mesh.rotation.x=THREE.MathUtils.lerp(s.mesh.rotation.x,y,.12),s.mesh.rotation.z=THREE.MathUtils.lerp(s.mesh.rotation.z,d,.12),t.invuln=Math.max(0,t.invuln-e);for(const n of g){if(!n.alive)continue;n.hitFlash=Math.max(0,n.hitFlash-e),n.material&&(n.material.emissiveIntensity=n.hitFlash>0?.9:0);const h=s.pos.x-n.pos.x,T=s.pos.z-n.pos.z,H=Math.hypot(h,T)||1,M=h/H,L=T/H;n.wobble+=e*6.2;const A=Math.sin(n.wobble)*.18;if(n.kind==="charger")if(n.dash>0){n.dash=Math.max(0,n.dash-e);const I=9.6;n.vel.x=n.dashDir.x*I,n.vel.z=n.dashDir.z*I}else n.telegraph>0?(n.telegraph=Math.max(0,n.telegraph-e),n.vel.x=0,n.vel.z=0,n.material&&(n.material.emissive=new THREE.Color(16773808),n.material.emissiveIntensity=.6+Math.sin(n.wobble*6)*.25),n.telegraph<=0&&(n.dash=.35,n.dashDir.set(M,0,L))):(n.vel.x=(M+A*L)*(l.enemySpeed*.9),n.vel.z=(L-A*M)*(l.enemySpeed*.9),H<4.2&&Math.random()<e*.8&&(n.telegraph=.35));else n.vel.x=(M+A*L)*l.enemySpeed,n.vel.z=(L-A*M)*l.enemySpeed;n.pos.x+=n.vel.x*e,n.pos.z+=n.vel.z*e,N(n.pos);const ae=Math.sin(n.wobble*.5)*.05;if(n.mesh.position.set(n.pos.x,.85+ae,n.pos.z),H<.85&&(s.pos.x-=M*.22,s.pos.z-=L*.22,t.invuln<=0)){t.hp-=1,t.invuln=.75,t.combo=0,t.comboTimer=0,t.hitstop=Math.max(t.hitstop,.08),b.thump(),f.position.x+=(Math.random()-.5)*.35,f.position.z+=(Math.random()-.5)*.35;const I=s.mesh.material;I&&(I.opacity=.3,I.transparent=!0,gsap.to(I,{opacity:1,duration:.22,yoyo:!0,repeat:3,ease:"power2.out"}));const P=document.getElementById("hp");if(P&&(P.textContent="â¤".repeat(Math.max(0,t.hp))+"â™¡".repeat(Math.max(0,3-t.hp)),gsap.fromTo(P,{scale:1.3},{scale:1,duration:.25,ease:"back.out(3)"})),t.hp<=0){_();return}}}Re(e);for(let n=C.length-1;n>=0;n--){const h=C[n];h.life-=e,h.pos.x+=h.vel.x*e,h.pos.z+=h.vel.z*e,h.mesh.position.set(h.pos.x,.9,h.pos.z);for(const T of g){if(!T.alive)continue;const H=T.pos.x-h.pos.x,M=T.pos.z-h.pos.z;if(H*H+M*M<.42*.42){ge(T,1,!1),h.life=-1;break}}h.life<=0&&(E.remove(h.mesh),C.splice(n,1))}for(let n=k.length-1;n>=0;n--)k[n].life-=e,k[n].life<=0&&k.splice(n,1);$.target.set(s.pos.x,0,s.pos.z);const v=new THREE.Vector3(s.pos.x,8.8,s.pos.z+9.2);f.position.lerp(v,.08),f.lookAt($.target);const m=document.getElementById("time"),w=document.getElementById("ko"),x=document.getElementById("combo"),S=document.getElementById("heat"),R=document.getElementById("heatTxt"),Y=document.getElementById("specialBtn");if(m&&(m.textContent=t.timeLeft.toFixed(1)),w&&(w.textContent=String(t.ko)),x&&(x.textContent=t.combo>0?`${t.combo} HIT`:"â€”"),S&&(S.style.width=`${(t.heat*100).toFixed(0)}%`),R&&(R.textContent=`x${(1+t.heat*.9).toFixed(2)}`),Y){const n=Y;n.disabled=t.phase!=="playing";const h=n.querySelector(".special-sub");h&&(h.textContent=t.specialReadyIn>0?`CT ${t.specialReadyIn.toFixed(1)}s`:"READY"),n.classList.toggle("ready",t.specialReadyIn<=0)}}const D=(()=>{const e=new THREE.BufferGeometry,o=new THREE.PointsMaterial({size:.14,color:16777215,transparent:!0,opacity:.9}),a=new THREE.Points(e,o);return a.frustumCulled=!1,E.add(a),{geo:e,mat:o,points:a}})();function be(){for(const i of g)i.alive&&i.mesh.lookAt(f.position);s.mesh.lookAt(f.position);const e=[],o=[];for(const i of k){const r=i.life/.32,c=12;for(let p=0;p<c;p++){const u=p/c*Math.PI*2+i.seed,d=(1-r)*.9,y=i.pos.x+Math.cos(u)*d,v=.12+(1-r)*.6+Math.sin(u*2)*.05,m=i.pos.z+Math.sin(u)*d;e.push(y,v,m);const w=[[1,1,1],[1,.92,.2],[.2,1,.55],[.2,.8,1],[1,.2,.6]],x=i.seed*1e3|0,S=(p+x)%w.length,R=w[S];o.push(R[0],R[1],R[2])}}const a=D.geo;a.setAttribute("position",new THREE.Float32BufferAttribute(e,3)),a.setAttribute("color",new THREE.Float32BufferAttribute(o,3)),D.mat.vertexColors=!0,D.mat.opacity=t.phase==="playing"?.95:.55,z.render(E,f)}let J=0,G=0;function se(e){const o=Math.min(e-J,ie);for(J=e,G+=o;G>=F;)Me(F/1e3),G-=F;be(),requestAnimationFrame(se)}function He(){f.aspect=window.innerWidth/window.innerHeight,f.updateProjectionMatrix(),z.setSize(window.innerWidth,window.innerHeight)}function V(e,o){t.keys[e]=o}function Q(e,o){const a=e.key.toLowerCase();let i=!0;a==="arrowup"||a==="w"?V("up",o):a==="arrowdown"||a==="s"?V("down",o):a==="arrowleft"||a==="a"?V("left",o):a==="arrowright"||a==="d"?V("right",o):i=!1,i&&e.preventDefault()}function ze(){oe(!1),W(),window.addEventListener("resize",He),B.addEventListener("pointerdown",we,{passive:!0}),B.addEventListener("pointermove",xe,{passive:!0}),B.addEventListener("pointerup",j,{passive:!0}),B.addEventListener("pointercancel",j,{passive:!0}),window.addEventListener("keydown",e=>Q(e,!0),{passive:!1}),window.addEventListener("keyup",e=>Q(e,!1),{passive:!1}),requestAnimationFrame(se)}ze();</script>
  <style rel="stylesheet" crossorigin>:root{--bg0: #fff6d8;--bg1: #ffd2f1;--hot: #ff2a6d;--lemon: #ffe600;--mint: #18ffb8;--sky: #6df0ff;--ink: rgba(255, 255, 255, .92);--ink-dim: rgba(255, 255, 255, .72);--shadow: rgba(0, 0, 0, .35);--radius: 22px}*{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;overflow:hidden;font-family:"M PLUS Rounded 1c",system-ui,-apple-system,Segoe UI,sans-serif;background:radial-gradient(1000px 800px at 20% 0%,rgba(255,42,109,.25),transparent 60%),radial-gradient(900px 700px at 90% 10%,rgba(109,240,255,.22),transparent 55%),radial-gradient(900px 900px at 50% 100%,rgba(255,230,0,.18),transparent 55%),linear-gradient(160deg,var(--bg0),var(--bg1));color:var(--ink);touch-action:manipulation;-webkit-tap-highlight-color:transparent;user-select:none}#game-canvas{position:fixed;inset:0;width:100%;height:100%;z-index:0}#app{position:fixed;inset:0;width:100%;height:100%;z-index:10;pointer-events:none}.hud{position:absolute;top:max(10px,env(safe-area-inset-top));left:max(10px,env(safe-area-inset-left));right:max(10px,env(safe-area-inset-right));display:flex;align-items:flex-start;justify-content:space-between;gap:10px;flex-wrap:wrap;pointer-events:none}.hud-right{display:flex;align-items:flex-start;gap:8px;flex-wrap:wrap;justify-content:flex-end}.hud-left{display:flex;gap:8px;flex-wrap:wrap}.pill{pointer-events:none;display:inline-flex;align-items:baseline;gap:10px;padding:10px 12px;border-radius:999px;background:#ffffff14;backdrop-filter:blur(10px);box-shadow:0 10px 30px var(--shadow);border:1px solid rgba(255,255,255,.12)}.pill.hp .value{letter-spacing:.14em}.pill.combo{background:#ffffff1a}.pill.combo .value{color:#ffe600f2}.pill .label{font-weight:800;letter-spacing:.08em;font-size:11px;color:#ffffffbf}.pill .value{font-weight:800;font-size:18px;color:#fffffff2;text-shadow:0 6px 18px rgba(0,0,0,.35)}.meter{pointer-events:none;width:clamp(120px,26vw,140px);padding:9px 10px;border-radius:18px;background:#ffffff14;backdrop-filter:blur(10px);box-shadow:0 10px 30px var(--shadow);border:1px solid rgba(255,255,255,.12)}.meter-top{display:flex;justify-content:space-between;align-items:baseline;gap:10px}.m-label{font-weight:900;letter-spacing:.12em;font-size:11px;color:#ffffffb3}.m-value{font-weight:900;font-size:12px;color:#ffffffe6}.bar{margin-top:7px;height:10px;border-radius:999px;overflow:hidden;background:#00000047;border:1px solid rgba(255,255,255,.1)}.barFill{height:100%;width:0%;background:linear-gradient(90deg,#18ffb8f2,#ffe600f2,#ff2a6df2);transition:width .12s linear}.special{pointer-events:auto;border:0;border-radius:18px;padding:10px 12px;width:96px;cursor:pointer;color:#111;background:linear-gradient(135deg,#ffe600f2,#18ffb8e6);box-shadow:0 16px 40px #00000059;transform:translateZ(0);transition:transform .12s ease,filter .12s ease,opacity .12s ease}.special:active{transform:scale(.98)}.special:disabled{opacity:.55;filter:grayscale(.4);cursor:not-allowed}.special.ready{box-shadow:0 0 0 1px #ffe60073,0 18px 44px #ff2a6d40}.special-top{font-weight:900;font-size:16px;letter-spacing:.06em}.special-sub{margin-top:2px;font-weight:800;font-size:12px;opacity:.78}.center-layer{position:absolute;inset:0;display:grid;place-items:center;padding:18px;pointer-events:none}.card{pointer-events:auto;width:min(540px,100%);border-radius:var(--radius);padding:22px 18px 18px;background:#0a080e9e;backdrop-filter:blur(14px);border:1px solid rgba(255,255,255,.14);box-shadow:0 30px 80px #0000008c}.badge{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;font-weight:900;letter-spacing:.08em;font-size:12px;background:#ffffff14;border:1px solid rgba(255,255,255,.12)}.title{margin-top:10px;font-size:clamp(2.1rem,8vw,3.1rem);font-weight:900;line-height:1.05;background:linear-gradient(135deg,var(--lemon),var(--hot),var(--sky));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-shadow:0 12px 30px rgba(255,42,109,.25)}.subtitle{margin-top:10px;color:var(--ink-dim);font-weight:800;line-height:1.55}.howto{margin-top:16px;display:grid;gap:10px}.howto-item{display:flex;justify-content:space-between;gap:12px;padding:10px 12px;border-radius:14px;background:#ffffff12;border:1px solid rgba(255,255,255,.12)}.howto-item .k{font-weight:900;letter-spacing:.06em;color:#ffffffeb}.howto-item .v{font-weight:800;color:#ffffffbf}.btn{margin-top:18px;width:100%;border:0;border-radius:16px;padding:14px 16px;font-size:16px;font-weight:900;letter-spacing:.03em;cursor:pointer;background:linear-gradient(135deg,var(--hot),#ff9f1c);color:#fffffff5;box-shadow:0 18px 44px #ff2a6d40;transition:transform .12s ease,filter .12s ease}.btn:active{transform:scale(.99)}.btn.ghost{background:#ffffff14;border:1px solid rgba(255,255,255,.14);box-shadow:0 20px 50px #00000059}.cta{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:18px}.hint{margin-top:12px;font-size:12px;line-height:1.45;color:#ffffff9e}.toast{position:absolute;bottom:18px;left:50%;transform:translate(-50%);padding:10px 14px;border-radius:999px;background:#0000008c;border:1px solid rgba(255,255,255,.16);box-shadow:0 18px 50px #0000008c;font-weight:900;letter-spacing:.02em}@media (max-width: 420px){.cta{grid-template-columns:1fr}.special{width:88px}}</style>
</head>

<body>
  <div id="app"></div>
  <canvas id="game-canvas"></canvas>
</body>

</html>