<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ãã®ã“ç„¡åŒ | DreamCore</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;800&display=swap" rel="stylesheet">

  <!-- CDN Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>

  <!-- Three.js (ã‚°ãƒ­ãƒ¼ãƒãƒ«ç‰ˆ) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script type="module" crossorigin>(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function s(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(i){if(i.ep)return;i.ep=!0;const r=s(i);fetch(i.href,r)}})();const P=1e3/60,ne=100,p={arenaRadius:18,playerSpeed:9,enemySpeed:2.7,spawnPerSecond:12,maxEnemies:220,autoAttackInterval:.12,autoAttackRange:3.8,bulletSpeed:26,bulletLife:.5,specialRadius:6.6,specialCooldown:5.5,roundTime:30},t={phase:"title",timeLeft:p.roundTime,ko:0,elapsed:0,hp:3,invuln:0,combo:0,comboTimer:0,heat:0,hitstop:0,pointerDown:!1,pointerId:-1,swipeStart:{x:0,y:0},swipeNow:{x:0,y:0},moveVec:new THREE.Vector2(0,0),keys:{up:!1,down:!1,left:!1,right:!1},atkTimer:0,spawnTimer:0,specialReadyIn:0},M=(()=>{let e=null;function o(){return e||(e=new(window.AudioContext||window.webkitAudioContext)),e}function s(d=660,m=.06,u="square",w=.04){try{const y=o(),v=y.currentTime,E=y.createOscillator(),g=y.createGain();E.type=u,E.frequency.setValueAtTime(d,v),E.frequency.exponentialRampToValueAtTime(d*.6,v+m),g.gain.setValueAtTime(1e-4,v),g.gain.exponentialRampToValueAtTime(w,v+.01),g.gain.exponentialRampToValueAtTime(1e-4,v+m),E.connect(g),g.connect(y.destination),E.start(v),E.stop(v+m)}catch{}}function a(){s(860,.05,"square",.05)}function i(){s(140,.09,"sine",.06)}function r(){s(520,.09,"sawtooth",.06),setTimeout(()=>s(220,.11,"sine",.05),60)}return{ensure:o,pop:a,thump:i,special:r}})(),S=document.getElementById("game-canvas"),f=new THREE.Scene;f.fog=new THREE.Fog(16774102,26,70);const h=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.1,80),H=new THREE.WebGLRenderer({canvas:S,antialias:!0,alpha:!1});H.setSize(window.innerWidth,window.innerHeight);H.setPixelRatio(Math.min(window.devicePixelRatio,2));H.setClearColor(16774102,1);H.outputEncoding=THREE.sRGBEncoding;H.toneMapping=THREE.ACESFilmicToneMapping;H.toneMappingExposure=1.15;f.add(new THREE.AmbientLight(16777215,1.05));const se=new THREE.HemisphereLight(16777215,16762856,.65);f.add(se);const j=new THREE.DirectionalLight(16777215,1.1);j.position.set(6,12,7);f.add(j);(()=>{const e=new THREE.CircleGeometry(p.arenaRadius+3.5,64),o=(()=>{const i=document.createElement("canvas");i.width=512,i.height=512;const r=i.getContext("2d"),d=r.createLinearGradient(0,0,512,512);d.addColorStop(0,"#ff2a6d"),d.addColorStop(.45,"#ff9f1c"),d.addColorStop(1,"#6df0ff"),r.fillStyle=d,r.fillRect(0,0,512,512);for(let w=0;w<950;w++){const y=Math.random()*512,v=Math.random()*512,E=2+Math.random()*8,g=1+Math.random()*4,n=Math.random()*Math.PI;r.save(),r.translate(y,v),r.rotate(n),r.globalAlpha=.35+Math.random()*.35;const l=["#ffffff","#0011ff","#00ff66","#ffe600","#ff004c"];r.fillStyle=l[Math.random()*l.length|0],r.fillRect(-E/2,-g/2,E,g),r.restore()}const m=r.createRadialGradient(256,256,60,256,256,330);m.addColorStop(0,"rgba(0,0,0,0)"),m.addColorStop(1,"rgba(0,0,0,0.45)"),r.fillStyle=m,r.fillRect(0,0,512,512);const u=new THREE.CanvasTexture(i);return u.wrapS=u.wrapT=THREE.RepeatWrapping,u.repeat.set(1.2,1.2),u.encoding=THREE.sRGBEncoding,u})(),s=new THREE.MeshStandardMaterial({map:o,roughness:1,metalness:0}),a=new THREE.Mesh(e,s);a.rotation.x=-Math.PI/2,a.position.y=-.01,a.receiveShadow=!1,f.add(a)})();(()=>{const e=new THREE.RingGeometry(p.arenaRadius+2.4,p.arenaRadius+3,64),o=new THREE.MeshBasicMaterial({color:16773808,transparent:!0,opacity:.35,side:THREE.DoubleSide}),s=new THREE.Mesh(e,o);s.rotation.x=-Math.PI/2,s.position.y=.02,f.add(s)})();const ae=new THREE.TextureLoader;function O(e){const o=ae.load(e);return o.encoding=THREE.sRGBEncoding,o.magFilter=THREE.NearestFilter,o.minFilter=THREE.LinearMipMapLinearFilter,o.anisotropy=4,o}const ie=O("./assets/kinoko.png"),re=O("./assets/takenoko.png"),ce=O("./assets/takenoko_charger.png");function J(e,o=1.45){const s=new THREE.PlaneGeometry(o,o),a=new THREE.MeshStandardMaterial({map:e,transparent:!0,alphaTest:.35,roughness:.8,metalness:0}),i=new THREE.Mesh(s,a);return i.rotation.order="YXZ",i}const c=(()=>{const e=J(ie,1.65);return e.position.set(0,.95,0),f.add(e),{mesh:e,pos:new THREE.Vector3(0,0,0),vel:new THREE.Vector3(0,0,0)}})(),T=[],L=[],k=[];function le(){if(T.length>=p.maxEnemies)return;const e=Math.random()*Math.PI*2,o=p.arenaRadius+1.5,s=Math.cos(e)*o,a=Math.sin(e)*o,i=THREE.MathUtils.clamp(.08+t.elapsed/p.roundTime*.22,.08,.3),r=Math.random()<i?"charger":"grunt",u=J(r==="charger"?ce:re,r==="charger"?1.55:1.35);u.position.set(s,.85,a),f.add(u);const w=u.material;T.push({kind:r,mesh:u,material:w,pos:new THREE.Vector3(s,0,a),vel:new THREE.Vector3(0,0,0),alive:!0,wobble:Math.random()*Math.PI*2,hp:r==="charger"?2:1,telegraph:0,dash:0,dashDir:new THREE.Vector3(0,0,1),hitFlash:0})}function pe(e,o){const s=new THREE.Vector3().subVectors(o,e).normalize(),a=new THREE.Mesh(new THREE.SphereGeometry(.11,10,10),new THREE.MeshStandardMaterial({color:2824976,roughness:.6,metalness:0,emissive:590849}));a.position.copy(e),a.position.y=.95,f.add(a),L.push({mesh:a,pos:e.clone(),vel:s.multiplyScalar(p.bulletSpeed),life:p.bulletLife})}function de(e,o){k.push({pos:new THREE.Vector3(e,.12,o),life:.32,seed:Math.random()*9999})}const D={target:new THREE.Vector3(0,0,0),pos:new THREE.Vector3(0,9,9)};h.position.copy(D.pos);h.lookAt(0,0,0);const me=document.getElementById("app");function N(){const e="â¤".repeat(Math.max(0,t.hp))+"â™¡".repeat(Math.max(0,3-t.hp));me.innerHTML=`
  <div class="hud">
    <div class="hud-left">
      <div class="pill"><span class="label">TIME</span><span id="time" class="value">${t.timeLeft.toFixed(1)}</span></div>
      <div class="pill"><span class="label">KO</span><span id="ko" class="value">${t.ko}</span></div>
      <div class="pill hp"><span class="label">HP</span><span id="hp" class="value">${e}</span></div>
    </div>

    <div class="hud-right">
      <div class="meter" title="è¿‘è·é›¢ã§ä¸ŠãŒã‚‹ã€‚æ”»æ’ƒãŒé€Ÿããªã‚‹ã‘ã©å±ãªã„">
        <div class="meter-top">
          <span class="m-label">HEAT</span>
          <span class="m-value" id="heatTxt">x${(1+t.heat*.9).toFixed(2)}</span>
        </div>
        <div class="bar"><div class="barFill" id="heat" style="width:${(t.heat*100).toFixed(0)}%"></div></div>
      </div>

      <button id="specialBtn" class="special" ${t.phase!=="playing"?"disabled":""}>
        <div class="special-top">å¿…æ®º</div>
        <div class="special-sub">${t.specialReadyIn>0?`CT ${t.specialReadyIn.toFixed(1)}s`:"READY"}</div>
      </button>
    </div>
  </div>

  <div class="center-layer" id="centerLayer"></div>
  `}function ue(){const e=document.getElementById("centerLayer");e.innerHTML=`
    <div class="card">
      <div class="badge">ğŸ„ vs ğŸ</div>
      <h1 class="title">ãã®ã“ç„¡åŒ</h1>
      <p class="subtitle">30ç§’ã§ãŸã‘ã®ã“ã‚’ã©ã‚Œã ã‘å€’ã›ã‚‹ï¼Ÿ</p>

      <div class="howto">
        <div class="howto-item"><span class="k">æ“ä½œ</span><span class="v">ã‚¹ãƒ¯ã‚¤ãƒ—ã§ç§»å‹•</span></div>
        <div class="howto-item"><span class="k">æ”»æ’ƒ</span><span class="v">è¿‘ã„æ•µã‚’ã‚ªãƒ¼ãƒˆã§æ”»æ’ƒ</span></div>
        <div class="howto-item"><span class="k">å¿…æ®º</span><span class="v">ãƒœã‚¿ãƒ³ã§å‘¨å›²ã‚’ä¸€æƒï¼ˆCTã‚ã‚Šï¼‰</span></div>
      </div>

      <button id="startBtn" class="btn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      <div class="hint">â€»éŸ³ã‚’é³´ã‚‰ã—ãŸã„äººã¯ã€æœ€åˆã®ã‚¿ãƒƒãƒ—ã§è‡ªå‹•çš„ã«åŠ¹æœéŸ³ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™</div>
    </div>
  `,document.getElementById("startBtn").addEventListener("click",()=>{M.ensure(),K()})}function he(){const e=document.getElementById("centerLayer");e.innerHTML=`
    <div class="card result">
      <div class="badge">RESULT</div>
      <h2 class="title">KO: ${t.ko}</h2>
      <p class="subtitle">ãã®ã“æ´¾ã€å¼·ã™ãã€‚</p>

      <div class="cta">
        <button id="retryBtn" class="btn">ã‚‚ã†ä¸€å›</button>
        <button id="copyBtn" class="btn ghost">æŠ•ç¨¿æ–‡ã‚³ãƒ”ãƒ¼</button>
      </div>

      <div class="hint">Xã«å‹•ç”»ã‚’è¼‰ã›ã¦ã€ãƒªãƒ—ã«DreamCoreãƒªãƒ³ã‚¯ã‚’è²¼ã‚‹æƒ³å®š</div>
    </div>
  `,document.getElementById("retryBtn").addEventListener("click",()=>{M.ensure(),Q(!1),K()}),document.getElementById("copyBtn").addEventListener("click",async()=>{const o=`ã€ãã®ã“ç„¡åŒã€‘30ç§’ã§KO: ${t.ko}ã€‚
ã‚ãªãŸã¯ä½•KOã„ã‘ã‚‹ï¼Ÿï¼ˆå‹•ç”»ã¤ãï¼‰
#ãã®ã“ã®å±± #ãŸã‘ã®ã“ã®é‡Œ #ãã®ã“ãŸã‘ã®ã“æˆ¦äº‰`;try{await navigator.clipboard.writeText(o),G("ã‚³ãƒ”ãƒ¼ã—ãŸï¼ã“ã®ã¾ã¾Xã«è²¼ã‚Œã‚‹ã‚ˆ"),M.pop()}catch{G("ã‚³ãƒ”ãƒ¼ã§ããªã‹ã£ãŸâ€¦ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶æ¨©é™ï¼‰")}})}let q=null;function G(e){const o=document.getElementById("centerLayer"),s=document.createElement("div");s.className="toast",s.textContent=e,o.appendChild(s),gsap.fromTo(s,{y:12,opacity:0},{y:0,opacity:1,duration:.22,ease:"power2.out"}),clearTimeout(q),q=setTimeout(()=>{gsap.to(s,{opacity:0,y:-8,duration:.25,onComplete:()=>s.remove()})},1200)}function U(){document.getElementById("specialBtn").addEventListener("click",()=>{M.ensure(),ve()})}function fe(){for(const e of L)f.remove(e.mesh);L.length=0;for(const e of T)f.remove(e.mesh);T.length=0,k.length=0,c.pos.set(0,0,0),c.mesh.position.set(0,.95,0)}function Q(e=!0){t.phase="title",t.timeLeft=p.roundTime,t.ko=0,t.elapsed=0,t.hp=3,t.invuln=0,t.combo=0,t.comboTimer=0,t.heat=0,t.hitstop=0,t.atkTimer=0,t.spawnTimer=0,t.specialReadyIn=0,fe(),N(),U(),e&&ue()}function K(){t.phase="playing",t.timeLeft=p.roundTime,t.ko=0,t.elapsed=0,t.hp=3,t.invuln=0,t.combo=0,t.comboTimer=0,t.heat=0,t.hitstop=0,t.atkTimer=0,t.spawnTimer=0,t.specialReadyIn=0,N(),U();const e=document.getElementById("centerLayer");gsap.to(e,{opacity:0,duration:.25,onComplete:()=>{e.innerHTML="",e.style.opacity="1"}}),gsap.fromTo(c.mesh.scale,{x:.3,y:.3,z:.3},{x:1,y:1,z:1,duration:.6,ease:"elastic.out(1,0.55)"})}function W(){t.phase="result",N(),U(),he()}function $(e){return{x:e.clientX,y:e.clientY}}function Ee(e){if(t.phase==="title"&&M.ensure(),t.phase!=="playing")return;const o=e.target;o&&o.closest&&o.closest("#specialBtn")||(t.pointerDown=!0,t.pointerId=e.pointerId,t.swipeStart=$(e),t.swipeNow=$(e),e.target.setPointerCapture?.(e.pointerId))}function ye(e){if(!t.pointerDown||e.pointerId!==t.pointerId)return;t.swipeNow=$(e);const o=t.swipeNow.x-t.swipeStart.x,s=t.swipeNow.y-t.swipeStart.y,a=new THREE.Vector2(o,s);if(a.length()<4){t.moveVec.set(0,0);return}a.normalize(),t.moveVec.set(a.x,a.y)}function X(e){e.pointerId===t.pointerId&&(t.pointerDown=!1,t.pointerId=-1,t.moveVec.set(0,0))}function ve(){if(t.phase!=="playing")return;if(t.specialReadyIn>0){M.thump();return}t.specialReadyIn=p.specialCooldown,M.special();const e=new THREE.Mesh(new THREE.RingGeometry(.2,.25,48),new THREE.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.9,side:THREE.DoubleSide}));e.rotation.x=-Math.PI/2,e.position.set(c.pos.x,.06,c.pos.z),f.add(e),gsap.to(e.scale,{x:p.specialRadius*3.2,y:p.specialRadius*3.2,z:1,duration:.35,ease:"power2.out"}),gsap.to(e.material,{opacity:0,duration:.35,ease:"power2.out",onComplete:()=>f.remove(e)});const o=c.pos.x,s=c.pos.z;for(const a of T){if(!a.alive)continue;const i=a.pos.x-o,r=a.pos.z-s;Math.hypot(i,r)<=p.specialRadius&&ee(a,!0)}gsap.fromTo(h.position,{x:h.position.x+.12,y:h.position.y,z:h.position.z+.12},{x:h.position.x,z:h.position.z,duration:.25,ease:"elastic.out(1,0.6)"})}function we(e,o=1,s=!1){e.alive&&(e.hp-=o,e.hitFlash=.12,e.material&&(e.material.emissive=new THREE.Color(16777215),e.material.emissiveIntensity=.9),e.hp<=0&&ee(e,s))}function ee(e,o=!1){if(!e.alive)return;e.alive=!1,t.combo+=1,t.comboTimer=1.25;const s=e.pos.x-c.pos.x,a=e.pos.z-c.pos.z,r=s*s+a*a<1.4*1.4?1:0;t.ko+=1+r,r&&G("è¿‘è·é›¢ãƒœãƒ¼ãƒŠã‚¹ +1KO"),t.specialReadyIn=Math.max(0,t.specialReadyIn-(o?.35:.15)),de(e.pos.x,e.pos.z),M.pop(),t.hitstop=Math.min(.06,t.hitstop+(o?.03:.02)),h.position.x+=(Math.random()-.5)*.12,h.position.z+=(Math.random()-.5)*.12,gsap.to(e.mesh.scale,{x:.01,y:.01,z:.01,duration:o?.14:.18,ease:"back.in(3)",onComplete:()=>{f.remove(e.mesh)}})}function ge(e){if(t.atkTimer-=e,t.atkTimer>0)return;const o=1+t.heat*.9,s=1+Math.min(1.5,t.combo*.03),a=Math.max(.08,p.autoAttackInterval/(o*(.85+s*.15)));t.atkTimer=a;let i=null,r=1/0;for(const m of T){if(!m.alive)continue;const u=m.pos.x-c.pos.x,w=m.pos.z-c.pos.z,y=Math.hypot(u,w);y<r&&(r=y,i=m)}if(!i||r>p.autoAttackRange)return;const d=new THREE.Vector3(i.pos.x,0,i.pos.z);pe(new THREE.Vector3(c.pos.x,0,c.pos.z),d)}function Y(e){const o=Math.hypot(e.x,e.z),s=p.arenaRadius;if(o>s){const a=s/o;e.x*=a,e.z*=a}}function xe(e){if(t.hitstop>0){t.hitstop=Math.max(0,t.hitstop-e),c.mesh.rotation.y+=e*1.2;return}if(t.phase!=="playing"){c.mesh.rotation.y+=e*.6;return}if(t.elapsed+=e,t.timeLeft=Math.max(0,p.roundTime-t.elapsed),t.timeLeft<=0){W();return}t.specialReadyIn=Math.max(0,t.specialReadyIn-e),t.comboTimer=Math.max(0,t.comboTimer-e),t.comboTimer<=0&&t.combo>0&&(t.combo=0);let o=0;for(const n of T){if(!n.alive)continue;const l=n.pos.x-c.pos.x,x=n.pos.z-c.pos.z;l*l+x*x<2.2*2.2&&o++}const s=Math.min(1,o/6);t.heat=THREE.MathUtils.lerp(t.heat,s,.08),t.spawnTimer+=e;const a=1/p.spawnPerSecond;for(;t.spawnTimer>=a;)t.spawnTimer-=a,le();const i=new THREE.Vector2(0,0);t.pointerDown?i.copy(t.moveVec):(t.keys.left&&(i.x-=1),t.keys.right&&(i.x+=1),t.keys.up&&(i.y+=1),t.keys.down&&(i.y-=1),i.lengthSq()>0&&i.normalize());const r=i.multiplyScalar(p.playerSpeed);c.vel.x=r.x,c.vel.z=r.y,c.pos.x+=c.vel.x*e,c.pos.z+=c.vel.z*e,Y(c.pos),c.mesh.position.set(c.pos.x,.95,c.pos.z);const d=THREE.MathUtils.clamp(c.vel.x/p.playerSpeed,-1,1)*-.18,m=THREE.MathUtils.clamp(c.vel.z/p.playerSpeed,-1,1)*.18;c.mesh.rotation.x=THREE.MathUtils.lerp(c.mesh.rotation.x,m,.12),c.mesh.rotation.z=THREE.MathUtils.lerp(c.mesh.rotation.z,d,.12),t.invuln=Math.max(0,t.invuln-e);for(const n of T){if(!n.alive)continue;n.hitFlash=Math.max(0,n.hitFlash-e),n.material&&(n.material.emissiveIntensity=n.hitFlash>0?.9:0);const l=c.pos.x-n.pos.x,x=c.pos.z-n.pos.z,b=Math.hypot(l,x)||1,R=l/b,I=x/b;n.wobble+=e*6.2;const C=Math.sin(n.wobble)*.18;if(n.kind==="charger")if(n.dash>0){n.dash=Math.max(0,n.dash-e);const z=9.6;n.vel.x=n.dashDir.x*z,n.vel.z=n.dashDir.z*z}else n.telegraph>0?(n.telegraph=Math.max(0,n.telegraph-e),n.vel.x=0,n.vel.z=0,n.material&&(n.material.emissive=new THREE.Color(16773808),n.material.emissiveIntensity=.6+Math.sin(n.wobble*6)*.25),n.telegraph<=0&&(n.dash=.35,n.dashDir.set(R,0,I))):(n.vel.x=(R+C*I)*(p.enemySpeed*.9),n.vel.z=(I-C*R)*(p.enemySpeed*.9),b<4.2&&Math.random()<e*.8&&(n.telegraph=.35));else n.vel.x=(R+C*I)*p.enemySpeed,n.vel.z=(I-C*R)*p.enemySpeed;n.pos.x+=n.vel.x*e,n.pos.z+=n.vel.z*e,Y(n.pos);const oe=Math.sin(n.wobble*.5)*.05;if(n.mesh.position.set(n.pos.x,.85+oe,n.pos.z),b<.85&&(c.pos.x-=R*.22,c.pos.z-=I*.22,t.invuln<=0)){t.hp-=1,t.invuln=.75,t.combo=0,t.comboTimer=0,t.hitstop=Math.max(t.hitstop,.08),M.thump(),h.position.x+=(Math.random()-.5)*.35,h.position.z+=(Math.random()-.5)*.35;const z=c.mesh.material;z&&(z.opacity=.3,z.transparent=!0,gsap.to(z,{opacity:1,duration:.22,yoyo:!0,repeat:3,ease:"power2.out"}));const A=document.getElementById("hp");if(A&&(A.textContent="â¤".repeat(Math.max(0,t.hp))+"â™¡".repeat(Math.max(0,3-t.hp)),gsap.fromTo(A,{scale:1.3},{scale:1,duration:.25,ease:"back.out(3)"})),t.hp<=0){W();return}}}ge(e);for(let n=L.length-1;n>=0;n--){const l=L[n];l.life-=e,l.pos.x+=l.vel.x*e,l.pos.z+=l.vel.z*e,l.mesh.position.set(l.pos.x,.9,l.pos.z);for(const x of T){if(!x.alive)continue;const b=x.pos.x-l.pos.x,R=x.pos.z-l.pos.z;if(b*b+R*R<.42*.42){we(x,1,!1),l.life=-1;break}}l.life<=0&&(f.remove(l.mesh),L.splice(n,1))}for(let n=k.length-1;n>=0;n--)k[n].life-=e,k[n].life<=0&&k.splice(n,1);D.target.set(c.pos.x,0,c.pos.z);const u=new THREE.Vector3(c.pos.x,8.8,c.pos.z+9.2);h.position.lerp(u,.08),h.lookAt(D.target);const w=document.getElementById("time"),y=document.getElementById("ko"),v=document.getElementById("heat"),E=document.getElementById("heatTxt"),g=document.getElementById("specialBtn");if(w&&(w.textContent=t.timeLeft.toFixed(1)),y&&(y.textContent=String(t.ko)),v&&(v.style.width=`${(t.heat*100).toFixed(0)}%`),E&&(E.textContent=`x${(1+t.heat*.9).toFixed(2)}`),g){const n=g;n.disabled=t.phase!=="playing";const l=n.querySelector(".special-sub");l&&(l.textContent=t.specialReadyIn>0?`CT ${t.specialReadyIn.toFixed(1)}s`:"READY"),n.classList.toggle("ready",t.specialReadyIn<=0)}}const F=(()=>{const e=new THREE.BufferGeometry,o=new THREE.PointsMaterial({size:.14,color:16777215,transparent:!0,opacity:.9}),s=new THREE.Points(e,o);return s.frustumCulled=!1,f.add(s),{geo:e,mat:o,points:s}})();function Te(){for(const a of T)a.alive&&a.mesh.lookAt(h.position);c.mesh.lookAt(h.position);const e=[],o=[];for(const a of k){const i=a.life/.32,r=12;for(let d=0;d<r;d++){const m=d/r*Math.PI*2+a.seed,u=(1-i)*.9,w=a.pos.x+Math.cos(m)*u,y=.12+(1-i)*.6+Math.sin(m*2)*.05,v=a.pos.z+Math.sin(m)*u;e.push(w,y,v);const E=[[1,1,1],[1,.92,.2],[.2,1,.55],[.2,.8,1],[1,.2,.6]],g=a.seed*1e3|0,n=(d+g)%E.length,l=E[n];o.push(l[0],l[1],l[2])}}const s=F.geo;s.setAttribute("position",new THREE.Float32BufferAttribute(e,3)),s.setAttribute("color",new THREE.Float32BufferAttribute(o,3)),F.mat.vertexColors=!0,F.mat.opacity=t.phase==="playing"?.95:.55,H.render(f,h)}let _=0,V=0;function te(e){const o=Math.min(e-_,ne);for(_=e,V+=o;V>=P;)xe(P/1e3),V-=P;Te(),requestAnimationFrame(te)}function Re(){h.aspect=window.innerWidth/window.innerHeight,h.updateProjectionMatrix(),H.setSize(window.innerWidth,window.innerHeight)}function B(e,o){t.keys[e]=o}function Z(e,o){const s=e.key.toLowerCase();let a=!0;s==="arrowup"||s==="w"?B("up",o):s==="arrowdown"||s==="s"?B("down",o):s==="arrowleft"||s==="a"?B("left",o):s==="arrowright"||s==="d"?B("right",o):a=!1,a&&e.preventDefault()}function Me(){Q(!1),K(),window.addEventListener("resize",Re),S.addEventListener("pointerdown",Ee,{passive:!0}),S.addEventListener("pointermove",ye,{passive:!0}),S.addEventListener("pointerup",X,{passive:!0}),S.addEventListener("pointercancel",X,{passive:!0}),window.addEventListener("keydown",e=>Z(e,!0),{passive:!1}),window.addEventListener("keyup",e=>Z(e,!1),{passive:!1}),requestAnimationFrame(te)}Me();</script>
  <style rel="stylesheet" crossorigin>:root{--bg0: #fff6d8;--bg1: #ffd2f1;--hot: #ff2a6d;--lemon: #ffe600;--mint: #18ffb8;--sky: #6df0ff;--ink: rgba(255, 255, 255, .92);--ink-dim: rgba(255, 255, 255, .72);--shadow: rgba(0, 0, 0, .35);--radius: 22px}*{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;overflow:hidden;font-family:"M PLUS Rounded 1c",system-ui,-apple-system,Segoe UI,sans-serif;background:radial-gradient(1000px 800px at 20% 0%,rgba(255,42,109,.25),transparent 60%),radial-gradient(900px 700px at 90% 10%,rgba(109,240,255,.22),transparent 55%),radial-gradient(900px 900px at 50% 100%,rgba(255,230,0,.18),transparent 55%),linear-gradient(160deg,var(--bg0),var(--bg1));color:var(--ink);touch-action:manipulation;-webkit-tap-highlight-color:transparent;user-select:none}#game-canvas{position:fixed;inset:0;width:100%;height:100%;z-index:0}#app{position:fixed;inset:0;width:100%;height:100%;z-index:10;pointer-events:none}.hud{position:absolute;top:max(10px,env(safe-area-inset-top));left:max(10px,env(safe-area-inset-left));right:max(10px,env(safe-area-inset-right));display:flex;align-items:flex-start;justify-content:space-between;gap:10px;flex-wrap:wrap;pointer-events:none}.hud-right{display:flex;align-items:flex-start;gap:8px;flex-wrap:wrap;justify-content:flex-end}.hud-left{display:flex;gap:8px;flex-wrap:wrap}.pill{pointer-events:none;display:inline-flex;align-items:baseline;gap:10px;padding:10px 12px;border-radius:999px;background:#ffffff14;backdrop-filter:blur(10px);box-shadow:0 10px 30px var(--shadow);border:1px solid rgba(255,255,255,.12)}.pill.hp .value{letter-spacing:.14em}.pill .label{font-weight:800;letter-spacing:.08em;font-size:11px;color:#ffffffbf}.pill .value{font-weight:800;font-size:18px;color:#fffffff2;text-shadow:0 6px 18px rgba(0,0,0,.35)}.meter{pointer-events:none;width:clamp(120px,26vw,140px);padding:9px 10px;border-radius:18px;background:#ffffff14;backdrop-filter:blur(10px);box-shadow:0 10px 30px var(--shadow);border:1px solid rgba(255,255,255,.12)}.meter-top{display:flex;justify-content:space-between;align-items:baseline;gap:10px}.m-label{font-weight:900;letter-spacing:.12em;font-size:11px;color:#ffffffb3}.m-value{font-weight:900;font-size:12px;color:#ffffffe6}.bar{margin-top:7px;height:10px;border-radius:999px;overflow:hidden;background:#00000047;border:1px solid rgba(255,255,255,.1)}.barFill{height:100%;width:0%;background:linear-gradient(90deg,#18ffb8f2,#ffe600f2,#ff2a6df2);transition:width .12s linear}.special{pointer-events:auto;border:0;border-radius:18px;padding:10px 12px;width:96px;cursor:pointer;color:#111;background:linear-gradient(135deg,#ffe600f2,#18ffb8e6);box-shadow:0 16px 40px #00000059;transform:translateZ(0);transition:transform .12s ease,filter .12s ease,opacity .12s ease}.special:active{transform:scale(.98)}.special:disabled{opacity:.55;filter:grayscale(.4);cursor:not-allowed}.special.ready{box-shadow:0 0 0 1px #ffe60073,0 18px 44px #ff2a6d40}.special-top{font-weight:900;font-size:16px;letter-spacing:.06em}.special-sub{margin-top:2px;font-weight:800;font-size:12px;opacity:.78}.center-layer{position:absolute;inset:0;display:grid;place-items:center;padding:18px;pointer-events:none}.card{pointer-events:auto;width:min(540px,100%);border-radius:var(--radius);padding:22px 18px 18px;background:#0a080e9e;backdrop-filter:blur(14px);border:1px solid rgba(255,255,255,.14);box-shadow:0 30px 80px #0000008c}.badge{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;font-weight:900;letter-spacing:.08em;font-size:12px;background:#ffffff14;border:1px solid rgba(255,255,255,.12)}.title{margin-top:10px;font-size:clamp(2.1rem,8vw,3.1rem);font-weight:900;line-height:1.05;background:linear-gradient(135deg,var(--lemon),var(--hot),var(--sky));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-shadow:0 12px 30px rgba(255,42,109,.25)}.subtitle{margin-top:10px;color:var(--ink-dim);font-weight:800;line-height:1.55}.howto{margin-top:16px;display:grid;gap:10px}.howto-item{display:flex;justify-content:space-between;gap:12px;padding:10px 12px;border-radius:14px;background:#ffffff12;border:1px solid rgba(255,255,255,.12)}.howto-item .k{font-weight:900;letter-spacing:.06em;color:#ffffffeb}.howto-item .v{font-weight:800;color:#ffffffbf}.btn{margin-top:18px;width:100%;border:0;border-radius:16px;padding:14px 16px;font-size:16px;font-weight:900;letter-spacing:.03em;cursor:pointer;background:linear-gradient(135deg,var(--hot),#ff9f1c);color:#fffffff5;box-shadow:0 18px 44px #ff2a6d40;transition:transform .12s ease,filter .12s ease}.btn:active{transform:scale(.99)}.btn.ghost{background:#ffffff14;border:1px solid rgba(255,255,255,.14);box-shadow:0 20px 50px #00000059}.cta{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:18px}.hint{margin-top:12px;font-size:12px;line-height:1.45;color:#ffffff9e}.toast{position:absolute;bottom:18px;left:50%;transform:translate(-50%);padding:10px 14px;border-radius:999px;background:#0000008c;border:1px solid rgba(255,255,255,.16);box-shadow:0 18px 50px #0000008c;font-weight:900;letter-spacing:.02em}@media (max-width: 420px){.cta{grid-template-columns:1fr}.special{width:88px}}</style>
</head>

<body>
  <div id="app"></div>
  <canvas id="game-canvas"></canvas>
</body>

</html>