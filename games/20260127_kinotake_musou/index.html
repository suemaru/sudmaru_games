<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>„Åç„ÅÆ„ÅìÁÑ°Âèå | DreamCore</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;800&display=swap" rel="stylesheet">

  <!-- CDN Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>

  <!-- Three.js („Ç∞„É≠„Éº„Éê„É´Áâà) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script type="module" crossorigin>(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function a(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(i){if(i.ep)return;i.ep=!0;const c=a(i);fetch(i.href,c)}})();const A=1e3/60,Q=100,p={arenaRadius:10,playerSpeed:7.2,enemySpeed:2.4,spawnPerSecond:2.6,maxEnemies:60,autoAttackInterval:.18,autoAttackRange:3,bulletSpeed:18,bulletLife:.45,specialRadius:4.6,specialCooldown:6.5,roundTime:30},e={phase:"title",timeLeft:p.roundTime,ko:0,elapsed:0,hp:3,invuln:0,combo:0,comboTimer:0,heat:0,hitstop:0,pointerDown:!1,pointerId:-1,swipeStart:{x:0,y:0},swipeNow:{x:0,y:0},moveVec:new THREE.Vector2(0,0),atkTimer:0,spawnTimer:0,specialReadyIn:0},g=(()=>{let t=null;function o(){return t||(t=new(window.AudioContext||window.webkitAudioContext)),t}function a(d=660,m=.06,E="square",T=.04){try{const v=o(),w=v.currentTime,y=v.createOscillator(),s=v.createGain();y.type=E,y.frequency.setValueAtTime(d,w),y.frequency.exponentialRampToValueAtTime(d*.6,w+m),s.gain.setValueAtTime(1e-4,w),s.gain.exponentialRampToValueAtTime(T,w+.01),s.gain.exponentialRampToValueAtTime(1e-4,w+m),y.connect(s),s.connect(v.destination),y.start(w),y.stop(w+m)}catch{}}function n(){a(860,.05,"square",.05)}function i(){a(140,.09,"sine",.06)}function c(){a(520,.09,"sawtooth",.06),setTimeout(()=>a(220,.11,"sine",.05),60)}return{ensure:o,pop:n,thump:i,special:c}})(),z=document.getElementById("game-canvas"),f=new THREE.Scene;f.fog=new THREE.Fog(1182486,10,26);const u=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.1,60),I=new THREE.WebGLRenderer({canvas:z,antialias:!0,alpha:!1});I.setSize(window.innerWidth,window.innerHeight);I.setPixelRatio(Math.min(window.devicePixelRatio,2));I.setClearColor(1182486,1);f.add(new THREE.AmbientLight(16777215,.7));const X=new THREE.DirectionalLight(16777215,.9);X.position.set(5,10,6);f.add(X);(()=>{const t=new THREE.CircleGeometry(p.arenaRadius+3.5,64),o=(()=>{const i=document.createElement("canvas");i.width=512,i.height=512;const c=i.getContext("2d"),d=c.createLinearGradient(0,0,512,512);d.addColorStop(0,"#ff2a6d"),d.addColorStop(.45,"#ff9f1c"),d.addColorStop(1,"#6df0ff"),c.fillStyle=d,c.fillRect(0,0,512,512);for(let T=0;T<950;T++){const v=Math.random()*512,w=Math.random()*512,y=2+Math.random()*8,s=1+Math.random()*4,l=Math.random()*Math.PI;c.save(),c.translate(v,w),c.rotate(l),c.globalAlpha=.35+Math.random()*.35;const h=["#ffffff","#0011ff","#00ff66","#ffe600","#ff004c"];c.fillStyle=h[Math.random()*h.length|0],c.fillRect(-y/2,-s/2,y,s),c.restore()}const m=c.createRadialGradient(256,256,60,256,256,330);m.addColorStop(0,"rgba(0,0,0,0)"),m.addColorStop(1,"rgba(0,0,0,0.45)"),c.fillStyle=m,c.fillRect(0,0,512,512);const E=new THREE.CanvasTexture(i);return E.wrapS=E.wrapT=THREE.RepeatWrapping,E.repeat.set(1.2,1.2),E.encoding=THREE.sRGBEncoding,E})(),a=new THREE.MeshStandardMaterial({map:o,roughness:1,metalness:0}),n=new THREE.Mesh(t,a);n.rotation.x=-Math.PI/2,n.position.y=-.01,n.receiveShadow=!1,f.add(n)})();(()=>{const t=new THREE.RingGeometry(p.arenaRadius+2.4,p.arenaRadius+3,64),o=new THREE.MeshBasicMaterial({color:16773808,transparent:!0,opacity:.35,side:THREE.DoubleSide}),a=new THREE.Mesh(t,o);a.rotation.x=-Math.PI/2,a.position.y=.02,f.add(a)})();const ee=new THREE.TextureLoader;function K(t){const o=ee.load(t);return o.encoding=THREE.sRGBEncoding,o.magFilter=THREE.NearestFilter,o.minFilter=THREE.LinearMipMapLinearFilter,o.anisotropy=4,o}const te=K("./assets/kinoko.png"),oe=K("./assets/takenoko.png");function Y(t,o=1.45){const a=new THREE.PlaneGeometry(o,o),n=new THREE.MeshStandardMaterial({map:t,transparent:!0,alphaTest:.35,roughness:.8,metalness:0}),i=new THREE.Mesh(a,n);return i.rotation.order="YXZ",i}const r=(()=>{const t=Y(te,1.65);return t.position.set(0,.95,0),f.add(t),{mesh:t,pos:new THREE.Vector3(0,0,0),vel:new THREE.Vector3(0,0,0)}})(),x=[],H=[],b=[];function ne(){if(x.length>=p.maxEnemies)return;const t=Math.random()*Math.PI*2,o=p.arenaRadius+1.5,a=Math.cos(t)*o,n=Math.sin(t)*o,i=Y(oe,1.35);i.position.set(a,.85,n),f.add(i),x.push({mesh:i,pos:new THREE.Vector3(a,0,n),vel:new THREE.Vector3(0,0,0),alive:!0,wobble:Math.random()*Math.PI*2})}function se(t,o){const a=new THREE.Vector3().subVectors(o,t).normalize(),n=new THREE.Mesh(new THREE.SphereGeometry(.11,10,10),new THREE.MeshStandardMaterial({color:2824976,roughness:.6,metalness:0,emissive:590849}));n.position.copy(t),n.position.y=.95,f.add(n),H.push({mesh:n,pos:t.clone(),vel:a.multiplyScalar(p.bulletSpeed),life:p.bulletLife})}function ae(t,o){b.push({pos:new THREE.Vector3(t,.12,o),life:.32,seed:Math.random()*9999})}const F={target:new THREE.Vector3(0,0,0),pos:new THREE.Vector3(0,9,9)};u.position.copy(F.pos);u.lookAt(0,0,0);const ie=document.getElementById("app");function L(){const t="‚ù§".repeat(Math.max(0,e.hp))+"‚ô°".repeat(Math.max(0,3-e.hp));ie.innerHTML=`
  <div class="hud">
    <div class="hud-left">
      <div class="pill"><span class="label">TIME</span><span id="time" class="value">${e.timeLeft.toFixed(1)}</span></div>
      <div class="pill"><span class="label">KO</span><span id="ko" class="value">${e.ko}</span></div>
      <div class="pill hp"><span class="label">HP</span><span id="hp" class="value">${t}</span></div>
    </div>

    <div class="hud-right">
      <div class="meter" title="ËøëË∑ùÈõ¢„Åß‰∏ä„Åå„Çã„ÄÇÊîªÊíÉ„ÅåÈÄü„Åè„Å™„Çã„Åë„Å©Âç±„Å™„ÅÑ">
        <div class="meter-top">
          <span class="m-label">HEAT</span>
          <span class="m-value" id="heatTxt">x${(1+e.heat*.9).toFixed(2)}</span>
        </div>
        <div class="bar"><div class="barFill" id="heat" style="width:${(e.heat*100).toFixed(0)}%"></div></div>
      </div>

      <button id="specialBtn" class="special" ${e.phase!=="playing"?"disabled":""}>
        <div class="special-top">ÂøÖÊÆ∫</div>
        <div class="special-sub">${e.specialReadyIn>0?`CT ${e.specialReadyIn.toFixed(1)}s`:"READY"}</div>
      </button>
    </div>
  </div>

  <div class="center-layer" id="centerLayer"></div>
  `}function re(){const t=document.getElementById("centerLayer");t.innerHTML=`
    <div class="card">
      <div class="badge">üçÑ vs üéç</div>
      <h1 class="title">„Åç„ÅÆ„ÅìÁÑ°Âèå</h1>
      <p class="subtitle">30Áßí„Åß„Åü„Åë„ÅÆ„Åì„Çí„Å©„Çå„Å†„ÅëÂÄí„Åõ„ÇãÔºü</p>

      <div class="howto">
        <div class="howto-item"><span class="k">Êìç‰Ωú</span><span class="v">„Çπ„ÉØ„Ç§„Éó„ÅßÁßªÂãï</span></div>
        <div class="howto-item"><span class="k">ÊîªÊíÉ</span><span class="v">Ëøë„ÅÑÊïµ„Çí„Ç™„Éº„Éà„ÅßÊîªÊíÉ</span></div>
        <div class="howto-item"><span class="k">ÂøÖÊÆ∫</span><span class="v">„Éú„Çø„É≥„ÅßÂë®Âõ≤„Çí‰∏ÄÊéÉÔºàCT„ÅÇ„ÇäÔºâ</span></div>
      </div>

      <button id="startBtn" class="btn">„Çπ„Çø„Éº„Éà</button>
      <div class="hint">‚ÄªÈü≥„ÇíÈ≥¥„Çâ„Åó„Åü„ÅÑ‰∫∫„ÅØ„ÄÅÊúÄÂàù„ÅÆ„Çø„ÉÉ„Éó„ÅßËá™ÂãïÁöÑ„Å´ÂäπÊûúÈü≥„ÅåÊúâÂäπ„Å´„Å™„Çä„Åæ„Åô</div>
    </div>
  `,document.getElementById("startBtn").addEventListener("click",()=>{g.ensure(),_()})}function ce(){const t=document.getElementById("centerLayer");t.innerHTML=`
    <div class="card result">
      <div class="badge">RESULT</div>
      <h2 class="title">KO: ${e.ko}</h2>
      <p class="subtitle">„Åç„ÅÆ„ÅìÊ¥æ„ÄÅÂº∑„Åô„Åé„ÄÇ</p>

      <div class="cta">
        <button id="retryBtn" class="btn">„ÇÇ„ÅÜ‰∏ÄÂõû</button>
        <button id="copyBtn" class="btn ghost">ÊäïÁ®øÊñá„Ç≥„Éî„Éº</button>
      </div>

      <div class="hint">X„Å´ÂãïÁîª„ÇíËºâ„Åõ„Å¶„ÄÅ„É™„Éó„Å´DreamCore„É™„É≥„ÇØ„ÇíË≤º„ÇãÊÉ≥ÂÆö</div>
    </div>
  `,document.getElementById("retryBtn").addEventListener("click",()=>{g.ensure(),Z(!1),_()}),document.getElementById("copyBtn").addEventListener("click",async()=>{const o=`„Äê„Åç„ÅÆ„ÅìÁÑ°Âèå„Äë30Áßí„ÅßKO: ${e.ko}„ÄÇ
„ÅÇ„Å™„Åü„ÅØ‰ΩïKO„ÅÑ„Åë„ÇãÔºüÔºàÂãïÁîª„Å§„ÅçÔºâ
#„Åç„ÅÆ„Åì„ÅÆÂ±± #„Åü„Åë„ÅÆ„Åì„ÅÆÈáå #„Åç„ÅÆ„Åì„Åü„Åë„ÅÆ„ÅìÊà¶‰∫â`;try{await navigator.clipboard.writeText(o),O("„Ç≥„Éî„Éº„Åó„ÅüÔºÅ„Åì„ÅÆ„Åæ„ÅæX„Å´Ë≤º„Çå„Çã„Çà"),g.pop()}catch{O("„Ç≥„Éî„Éº„Åß„Åç„Å™„Åã„Å£„Åü‚Ä¶Ôºà„Éñ„É©„Ç¶„Ç∂Ê®©ÈôêÔºâ")}})}let $=null;function O(t){const o=document.getElementById("centerLayer"),a=document.createElement("div");a.className="toast",a.textContent=t,o.appendChild(a),gsap.fromTo(a,{y:12,opacity:0},{y:0,opacity:1,duration:.22,ease:"power2.out"}),clearTimeout($),$=setTimeout(()=>{gsap.to(a,{opacity:0,y:-8,duration:.25,onComplete:()=>a.remove()})},1200)}function S(){document.getElementById("specialBtn").addEventListener("click",()=>{g.ensure(),ue()})}function le(){for(const t of H)f.remove(t.mesh);H.length=0;for(const t of x)f.remove(t.mesh);x.length=0,b.length=0,r.pos.set(0,0,0),r.mesh.position.set(0,.95,0)}function Z(t=!0){e.phase="title",e.timeLeft=p.roundTime,e.ko=0,e.elapsed=0,e.hp=3,e.invuln=0,e.combo=0,e.comboTimer=0,e.heat=0,e.hitstop=0,e.atkTimer=0,e.spawnTimer=0,e.specialReadyIn=0,le(),L(),S(),t&&re()}function _(){e.phase="playing",e.timeLeft=p.roundTime,e.ko=0,e.elapsed=0,e.hp=3,e.invuln=0,e.combo=0,e.comboTimer=0,e.heat=0,e.hitstop=0,e.atkTimer=0,e.spawnTimer=0,e.specialReadyIn=0,L(),S();const t=document.getElementById("centerLayer");gsap.to(t,{opacity:0,duration:.25,onComplete:()=>{t.innerHTML="",t.style.opacity="1"}}),gsap.fromTo(r.mesh.scale,{x:.3,y:.3,z:.3},{x:1,y:1,z:1,duration:.6,ease:"elastic.out(1,0.55)"})}function N(){e.phase="result",L(),S(),ce()}function D(t){return{x:t.clientX,y:t.clientY}}function pe(t){if(e.phase==="title"&&g.ensure(),e.phase!=="playing")return;const o=t.target;o&&o.closest&&o.closest("#specialBtn")||(e.pointerDown=!0,e.pointerId=t.pointerId,e.swipeStart=D(t),e.swipeNow=D(t),t.target.setPointerCapture?.(t.pointerId))}function de(t){if(!e.pointerDown||t.pointerId!==e.pointerId)return;e.swipeNow=D(t);const o=e.swipeNow.x-e.swipeStart.x,a=e.swipeNow.y-e.swipeStart.y,n=new THREE.Vector2(o,a);if(n.length()<4){e.moveVec.set(0,0);return}n.normalize(),e.moveVec.set(n.x,-n.y)}function U(t){t.pointerId===e.pointerId&&(e.pointerDown=!1,e.pointerId=-1,e.moveVec.set(0,0))}function ue(){if(e.phase!=="playing")return;if(e.specialReadyIn>0){g.thump();return}e.specialReadyIn=p.specialCooldown,g.special();const t=new THREE.Mesh(new THREE.RingGeometry(.2,.25,48),new THREE.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.9,side:THREE.DoubleSide}));t.rotation.x=-Math.PI/2,t.position.set(r.pos.x,.06,r.pos.z),f.add(t),gsap.to(t.scale,{x:p.specialRadius*3.2,y:p.specialRadius*3.2,z:1,duration:.35,ease:"power2.out"}),gsap.to(t.material,{opacity:0,duration:.35,ease:"power2.out",onComplete:()=>f.remove(t)});const o=r.pos.x,a=r.pos.z;for(const n of x){if(!n.alive)continue;const i=n.pos.x-o,c=n.pos.z-a;Math.hypot(i,c)<=p.specialRadius&&j(n,!0)}gsap.fromTo(u.position,{x:u.position.x+.12,y:u.position.y,z:u.position.z+.12},{x:u.position.x,z:u.position.z,duration:.25,ease:"elastic.out(1,0.6)"})}function j(t,o=!1){t.alive&&(t.alive=!1,e.combo+=1,e.comboTimer=1.25,e.ko+=1,e.specialReadyIn=Math.max(0,e.specialReadyIn-(o?.25:.12)),ae(t.pos.x,t.pos.z),g.pop(),e.hitstop=Math.min(.06,e.hitstop+(o?.03:.02)),u.position.x+=(Math.random()-.5)*.12,u.position.z+=(Math.random()-.5)*.12,gsap.to(t.mesh.scale,{x:.01,y:.01,z:.01,duration:o?.14:.18,ease:"back.in(3)",onComplete:()=>{f.remove(t.mesh)}}))}function me(t){if(e.atkTimer-=t,e.atkTimer>0)return;const o=1+e.heat*.9,a=1+Math.min(1.5,e.combo*.03),n=Math.max(.08,p.autoAttackInterval/(o*(.85+a*.15)));e.atkTimer=n;let i=null,c=1/0;for(const m of x){if(!m.alive)continue;const E=m.pos.x-r.pos.x,T=m.pos.z-r.pos.z,v=Math.hypot(E,T);v<c&&(c=v,i=m)}if(!i||c>p.autoAttackRange)return;const d=new THREE.Vector3(i.pos.x,0,i.pos.z);se(new THREE.Vector3(r.pos.x,0,r.pos.z),d)}function q(t){const o=Math.hypot(t.x,t.z),a=p.arenaRadius;if(o>a){const n=a/o;t.x*=n,t.z*=n}}function he(t){if(e.hitstop>0){e.hitstop=Math.max(0,e.hitstop-t),r.mesh.rotation.y+=t*1.2;return}if(e.phase!=="playing"){r.mesh.rotation.y+=t*.6;return}if(e.elapsed+=t,e.timeLeft=Math.max(0,p.roundTime-e.elapsed),e.timeLeft<=0){N();return}e.specialReadyIn=Math.max(0,e.specialReadyIn-t),e.comboTimer=Math.max(0,e.comboTimer-t),e.comboTimer<=0&&e.combo>0&&(e.combo=0);let o=0;for(const s of x){if(!s.alive)continue;const l=s.pos.x-r.pos.x,h=s.pos.z-r.pos.z;l*l+h*h<2.2*2.2&&o++}const a=Math.min(1,o/6);e.heat=THREE.MathUtils.lerp(e.heat,a,.08),e.spawnTimer+=t;const n=1/p.spawnPerSecond;for(;e.spawnTimer>=n;)e.spawnTimer-=n,ne();const i=e.moveVec.clone().multiplyScalar(p.playerSpeed);r.vel.x=i.x,r.vel.z=i.y,r.pos.x+=r.vel.x*t,r.pos.z+=r.vel.z*t,q(r.pos),r.mesh.position.set(r.pos.x,.95,r.pos.z);const c=THREE.MathUtils.clamp(r.vel.x/p.playerSpeed,-1,1)*-.18,d=THREE.MathUtils.clamp(r.vel.z/p.playerSpeed,-1,1)*.18;r.mesh.rotation.x=THREE.MathUtils.lerp(r.mesh.rotation.x,d,.12),r.mesh.rotation.z=THREE.MathUtils.lerp(r.mesh.rotation.z,c,.12),e.invuln=Math.max(0,e.invuln-t);for(const s of x){if(!s.alive)continue;const l=r.pos.x-s.pos.x,h=r.pos.z-s.pos.z,R=Math.hypot(l,h)||1,M=l/R,B=h/R;s.wobble+=t*6.2;const G=Math.sin(s.wobble)*.18;if(s.vel.x=(M+G*B)*p.enemySpeed,s.vel.z=(B-G*M)*p.enemySpeed,s.pos.x+=s.vel.x*t,s.pos.z+=s.vel.z*t,q(s.pos),s.mesh.position.set(s.pos.x,.85+Math.sin(s.wobble*.5)*.05,s.pos.z),R<.85&&(r.pos.x-=M*.22,r.pos.z-=B*.22,e.invuln<=0)){e.hp-=1,e.invuln=.75,e.combo=0,e.comboTimer=0,e.hitstop=Math.max(e.hitstop,.08),g.thump(),u.position.x+=(Math.random()-.5)*.35,u.position.z+=(Math.random()-.5)*.35;const k=r.mesh.material;k&&(k.opacity=.3,k.transparent=!0,gsap.to(k,{opacity:1,duration:.22,yoyo:!0,repeat:3,ease:"power2.out"}));const C=document.getElementById("hp");if(C&&(C.textContent="‚ù§".repeat(Math.max(0,e.hp))+"‚ô°".repeat(Math.max(0,3-e.hp)),gsap.fromTo(C,{scale:1.3},{scale:1,duration:.25,ease:"back.out(3)"})),e.hp<=0){N();return}}}me(t);for(let s=H.length-1;s>=0;s--){const l=H[s];l.life-=t,l.pos.x+=l.vel.x*t,l.pos.z+=l.vel.z*t,l.mesh.position.set(l.pos.x,.9,l.pos.z);for(const h of x){if(!h.alive)continue;const R=h.pos.x-l.pos.x,M=h.pos.z-l.pos.z;if(R*R+M*M<.42*.42){j(h,!1),l.life=-1;break}}l.life<=0&&(f.remove(l.mesh),H.splice(s,1))}for(let s=b.length-1;s>=0;s--)b[s].life-=t,b[s].life<=0&&b.splice(s,1);F.target.set(r.pos.x,0,r.pos.z);const m=new THREE.Vector3(r.pos.x,8.8,r.pos.z+9.2);u.position.lerp(m,.08),u.lookAt(F.target);const E=document.getElementById("time"),T=document.getElementById("ko"),v=document.getElementById("heat"),w=document.getElementById("heatTxt"),y=document.getElementById("specialBtn");if(E&&(E.textContent=e.timeLeft.toFixed(1)),T&&(T.textContent=String(e.ko)),v&&(v.style.width=`${(e.heat*100).toFixed(0)}%`),w&&(w.textContent=`x${(1+e.heat*.9).toFixed(2)}`),y){const s=y;s.disabled=e.phase!=="playing";const l=s.querySelector(".special-sub");l&&(l.textContent=e.specialReadyIn>0?`CT ${e.specialReadyIn.toFixed(1)}s`:"READY"),s.classList.toggle("ready",e.specialReadyIn<=0)}}const P=(()=>{const t=new THREE.BufferGeometry,o=new THREE.PointsMaterial({size:.14,color:16777215,transparent:!0,opacity:.9}),a=new THREE.Points(t,o);return a.frustumCulled=!1,f.add(a),{geo:t,mat:o,points:a}})();function fe(){for(const n of x)n.alive&&n.mesh.lookAt(u.position);r.mesh.lookAt(u.position);const t=[],o=[];for(const n of b){const i=n.life/.32,c=12;for(let d=0;d<c;d++){const m=d/c*Math.PI*2+n.seed,E=(1-i)*.9,T=n.pos.x+Math.cos(m)*E,v=.12+(1-i)*.6+Math.sin(m*2)*.05,w=n.pos.z+Math.sin(m)*E;t.push(T,v,w);const y=[[1,1,1],[1,.92,.2],[.2,1,.55],[.2,.8,1],[1,.2,.6]],s=n.seed*1e3|0,l=(d+s)%y.length,h=y[l];o.push(h[0],h[1],h[2])}}const a=P.geo;a.setAttribute("position",new THREE.Float32BufferAttribute(t,3)),a.setAttribute("color",new THREE.Float32BufferAttribute(o,3)),P.mat.vertexColors=!0,P.mat.opacity=e.phase==="playing"?.95:.55,I.render(f,u)}let W=0,V=0;function J(t){const o=Math.min(t-W,Q);for(W=t,V+=o;V>=A;)he(A/1e3),V-=A;fe(),requestAnimationFrame(J)}function Ee(){u.aspect=window.innerWidth/window.innerHeight,u.updateProjectionMatrix(),I.setSize(window.innerWidth,window.innerHeight)}function ye(){L(),S(),Z(!0),window.addEventListener("resize",Ee),z.addEventListener("pointerdown",pe,{passive:!0}),z.addEventListener("pointermove",de,{passive:!0}),z.addEventListener("pointerup",U,{passive:!0}),z.addEventListener("pointercancel",U,{passive:!0}),requestAnimationFrame(J)}ye();</script>
  <style rel="stylesheet" crossorigin>:root{--bg0: #120b16;--bg1: #1b1023;--hot: #ff2a6d;--lemon: #ffe600;--mint: #18ffb8;--sky: #6df0ff;--ink: rgba(255, 255, 255, .92);--ink-dim: rgba(255, 255, 255, .72);--shadow: rgba(0, 0, 0, .35);--radius: 22px}*{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;overflow:hidden;font-family:"M PLUS Rounded 1c",system-ui,-apple-system,Segoe UI,sans-serif;background:radial-gradient(1200px 900px at 15% 10%,rgba(255,42,109,.18),transparent 60%),radial-gradient(900px 700px at 85% 20%,rgba(109,240,255,.18),transparent 55%),linear-gradient(160deg,var(--bg0),var(--bg1));color:var(--ink);touch-action:manipulation;-webkit-tap-highlight-color:transparent;user-select:none}#game-canvas{position:fixed;inset:0;width:100%;height:100%;z-index:0}#app{position:fixed;inset:0;width:100%;height:100%;z-index:10;pointer-events:none}.hud{position:absolute;top:14px;left:14px;right:14px;display:flex;align-items:flex-start;justify-content:space-between;gap:12px;pointer-events:none}.hud-right{display:flex;align-items:flex-start;gap:10px}.hud-left{display:flex;gap:10px}.pill{pointer-events:none;display:inline-flex;align-items:baseline;gap:10px;padding:10px 12px;border-radius:999px;background:#ffffff14;backdrop-filter:blur(10px);box-shadow:0 10px 30px var(--shadow);border:1px solid rgba(255,255,255,.12)}.pill.hp .value{letter-spacing:.14em}.pill .label{font-weight:800;letter-spacing:.08em;font-size:11px;color:#ffffffbf}.pill .value{font-weight:800;font-size:18px;color:#fffffff2;text-shadow:0 6px 18px rgba(0,0,0,.35)}.meter{pointer-events:none;width:142px;padding:10px 12px;border-radius:18px;background:#ffffff14;backdrop-filter:blur(10px);box-shadow:0 10px 30px var(--shadow);border:1px solid rgba(255,255,255,.12)}.meter-top{display:flex;justify-content:space-between;align-items:baseline;gap:10px}.m-label{font-weight:900;letter-spacing:.12em;font-size:11px;color:#ffffffb3}.m-value{font-weight:900;font-size:12px;color:#ffffffe6}.bar{margin-top:7px;height:10px;border-radius:999px;overflow:hidden;background:#00000047;border:1px solid rgba(255,255,255,.1)}.barFill{height:100%;width:0%;background:linear-gradient(90deg,#18ffb8f2,#ffe600f2,#ff2a6df2);transition:width .12s linear}.special{pointer-events:auto;border:0;border-radius:18px;padding:10px 12px;width:96px;cursor:pointer;color:#111;background:linear-gradient(135deg,#ffe600f2,#18ffb8e6);box-shadow:0 16px 40px #00000059;transform:translateZ(0);transition:transform .12s ease,filter .12s ease,opacity .12s ease}.special:active{transform:scale(.98)}.special:disabled{opacity:.55;filter:grayscale(.4);cursor:not-allowed}.special.ready{box-shadow:0 0 0 1px #ffe60073,0 18px 44px #ff2a6d40}.special-top{font-weight:900;font-size:16px;letter-spacing:.06em}.special-sub{margin-top:2px;font-weight:800;font-size:12px;opacity:.78}.center-layer{position:absolute;inset:0;display:grid;place-items:center;padding:18px;pointer-events:none}.card{pointer-events:auto;width:min(540px,100%);border-radius:var(--radius);padding:22px 18px 18px;background:#0a080e9e;backdrop-filter:blur(14px);border:1px solid rgba(255,255,255,.14);box-shadow:0 30px 80px #0000008c}.badge{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;font-weight:900;letter-spacing:.08em;font-size:12px;background:#ffffff14;border:1px solid rgba(255,255,255,.12)}.title{margin-top:10px;font-size:clamp(2.1rem,8vw,3.1rem);font-weight:900;line-height:1.05;background:linear-gradient(135deg,var(--lemon),var(--hot),var(--sky));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-shadow:0 12px 30px rgba(255,42,109,.25)}.subtitle{margin-top:10px;color:var(--ink-dim);font-weight:800;line-height:1.55}.howto{margin-top:16px;display:grid;gap:10px}.howto-item{display:flex;justify-content:space-between;gap:12px;padding:10px 12px;border-radius:14px;background:#ffffff12;border:1px solid rgba(255,255,255,.12)}.howto-item .k{font-weight:900;letter-spacing:.06em;color:#ffffffeb}.howto-item .v{font-weight:800;color:#ffffffbf}.btn{margin-top:18px;width:100%;border:0;border-radius:16px;padding:14px 16px;font-size:16px;font-weight:900;letter-spacing:.03em;cursor:pointer;background:linear-gradient(135deg,var(--hot),#ff9f1c);color:#fffffff5;box-shadow:0 18px 44px #ff2a6d40;transition:transform .12s ease,filter .12s ease}.btn:active{transform:scale(.99)}.btn.ghost{background:#ffffff14;border:1px solid rgba(255,255,255,.14);box-shadow:0 20px 50px #00000059}.cta{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:18px}.hint{margin-top:12px;font-size:12px;line-height:1.45;color:#ffffff9e}.toast{position:absolute;bottom:18px;left:50%;transform:translate(-50%);padding:10px 14px;border-radius:999px;background:#0000008c;border:1px solid rgba(255,255,255,.16);box-shadow:0 18px 50px #0000008c;font-weight:900;letter-spacing:.02em}@media (max-width: 420px){.cta{grid-template-columns:1fr}.special{width:88px}}</style>
</head>

<body>
  <div id="app"></div>
  <canvas id="game-canvas"></canvas>
</body>

</html>